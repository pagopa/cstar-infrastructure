[0m[1mInitializing the backend...[0m
[0m[32m
Successfully configured the backend "azurerm"! Terraform will automatically
use this backend unless the backend configuration changes.[0m
[0m[1mInitializing modules...[0m
[0m[1mInitializing provider plugins...[0m
- Reusing previous version of hashicorp/azurerm from the dependency lock file
- Reusing previous version of hashicorp/azuread from the dependency lock file
- Reusing previous version of hashicorp/null from the dependency lock file
- Reusing previous version of hashicorp/kubernetes from the dependency lock file
- Reusing previous version of hashicorp/helm from the dependency lock file
- Using previously-installed hashicorp/azurerm v3.111.0
- Using previously-installed hashicorp/azuread v2.50.0
- Using previously-installed hashicorp/null v3.2.2
- Using previously-installed hashicorp/kubernetes v2.30.0
- Using previously-installed hashicorp/helm v2.12.1

[0m[1m[32mTerraform has been successfully initialized![0m[32m[0m
[0m[32m
You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.[0m
kubernetes_namespace.namespace_system: Refreshing state... [id=mil-system]
kubernetes_config_map.appinsights-config: Refreshing state... [id=mil/appinsights-config]
module.kubernetes_service_account.kubernetes_service_account.azure_devops: Refreshing state... [id=mil-system/azure-devops]
kubernetes_namespace.namespace: Refreshing state... [id=mil]
kubernetes_config_map.mil-common-poc: Refreshing state... [id=mil/mil-common-poc]
kubernetes_config_map.rest-client: Refreshing state... [id=mil/rest-client]
data.azuread_group.adgroup_admin: Reading...
data.azuread_group.adgroup_security: Reading...
data.azuread_group.adgroup_developers: Reading...
module.kubernetes_service_account.kubernetes_secret_v1.azure_devops_service_account_default_secret: Refreshing state... [id=mil-system/azure-devops-sa-token]
kubernetes_role_binding.deployer_binding: Refreshing state... [id=mil/deployer-binding]
data.azuread_group.adgroup_externals: Reading...
kubernetes_role_binding.system_deployer_binding: Refreshing state... [id=mil-system/system-deployer-binding]
helm_release.reloader: Refreshing state... [id=reloader]
module.kubernetes_service_account.data.kubernetes_secret.azure_devops_secret: Reading...
module.kubernetes_service_account.data.kubernetes_secret.azure_devops_secret: Read complete after 0s [id=mil-system/azure-devops-sa-token]
data.azuread_group.adgroup_security: Read complete after 0s [id=9639b851-3e1c-4c30-9c38-3fb1e06bd3f0]
data.azuread_group.adgroup_admin: Read complete after 0s [id=3c7414d1-a2de-465f-a43c-0ffb06dd3416]
data.azuread_group.adgroup_externals: Read complete after 0s [id=7556c7d0-4982-4f60-a326-d26aedc87e38]
data.azuread_group.adgroup_developers: Read complete after 0s [id=9ca511bf-8df4-4b60-b613-2f92b83bce71]
azurerm_api_management_product_api.auth: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/mil/apis/cstar-d-weu-mil-auth]
module.emd_citizen.azurerm_api_management_api_operation_policy.api_operation_policy["getTppEnabledList"]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-citizen/operations/getTppEnabledList]
module.emd_citizen.azurerm_api_management_api_policy.this[0]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-citizen]
azurerm_api_management_product.mil: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/mil]
module.emd_citizen.azurerm_api_management_api_operation_policy.api_operation_policy["saveCitizenConsent"]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-citizen/operations/saveCitizenConsent]
azurerm_resource_group.storage_rg: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-mil-storage-rg]
azurerm_key_vault_access_policy.access_auth_secret_kv: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-mil-sec-rg/providers/Microsoft.KeyVault/vaults/cstar-d-weu-mil-auth-kv/objectId/2abc7984-9d68-4b88-816f-b33369b9c025]
azurerm_api_management_product_policy.mil_api_product: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/mil]
azurerm_api_management_api_diagnostic.auth: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/cstar-d-weu-mil-auth/diagnostics/applicationinsights]
azurerm_storage_account.conf: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-mil-storage-rg/providers/Microsoft.Storage/storageAccounts/cstardmilconfst]
azurerm_api_management_api.auth: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/cstar-d-weu-mil-auth;rev=1]
module.emd_citizen.azurerm_api_management_api_operation_policy.api_operation_policy["updateState"]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-citizen/operations/updateState]
module.emd_citizen.azurerm_api_management_product_api.this["emd_api_product"]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/emd_api_product/apis/d-emd-citizen]
azurerm_api_management_api.papos: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/cstar-d-weu-mil-papos;rev=1]
module.emd_citizen.azurerm_api_management_api.this: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-citizen;rev=1]
module.emd_tpp.azurerm_api_management_api_operation_policy.api_operation_policy["get"]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-tpp/operations/get]
module.emd_tpp.azurerm_api_management_api.this: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-tpp;rev=1]
azurerm_api_management_product_api.papos: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/mil/apis/cstar-d-weu-mil-papos]
module.emd_tpp.azurerm_api_management_api_operation_policy.api_operation_policy["upsert"]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-tpp/operations/upsert]
module.emd_citizen.azurerm_api_management_api_operation_policy.api_operation_policy["getConsentStatus"]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-citizen/operations/getConsentStatus]
module.emd_tpp.azurerm_api_management_api_operation_policy.api_operation_policy["updateState"]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-tpp/operations/updateState]
module.emd_tpp.azurerm_api_management_api_policy.this[0]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-tpp]
module.emd_citizen.azurerm_api_management_api_operation_policy.api_operation_policy["get"]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-citizen/operations/get]
azurerm_api_management_api_diagnostic.papos: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/cstar-d-weu-mil-papos/diagnostics/applicationinsights]
azurerm_storage_account.auth: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-mil-storage-rg/providers/Microsoft.Storage/storageAccounts/cstardmilauthst]
module.pod_identity.azurerm_user_assigned_identity.this: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-dev01-aks-rg/providers/Microsoft.ManagedIdentity/userAssignedIdentities/mil-pod-identity]
module.emd_tpp.azurerm_api_management_product_api.this["emd_api_product"]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/emd_api_product/apis/d-emd-tpp]
data.azurerm_dns_zone.public: Reading...
data.azurerm_resource_group.apim_rg: Reading...
data.azurerm_resource_group.apim_rg: Read complete after 1s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg]
data.azurerm_key_vault.kv_domain: Reading...
data.azurerm_client_config.current: Reading...
data.azurerm_client_config.current: Read complete after 0s [id=Y2xpZW50Q29uZmlncy9jbGllbnRJZD0wNGIwNzc5NS04ZGRiLTQ2MWEtYmJlZS0wMmY5ZTFiZjdiNDY7b2JqZWN0SWQ9MjlhM2FiZmItOWY2MC00ZDU2LWE5MmMtZmI5NmE0YzI4ZmI3O3N1YnNjcmlwdGlvbklkPTRkMTc3ZGQ2LTVjN2QtNDBhYi04MDE5LTBjMWJlMzgwYTI1ZDt0ZW5hbnRJZD03Nzg4ZWRhZi0wMzQ2LTQwNjgtOWQ3OS1jODY4YWVkMTViM2Q=]
data.azurerm_monitor_action_group.email: Reading...
data.azurerm_private_dns_zone.internal: Reading...
data.azurerm_resource_group.monitor_rg: Reading...
data.azurerm_resource_group.monitor_rg: Read complete after 0s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-monitor-rg]
data.azurerm_log_analytics_workspace.log_analytics: Reading...
data.azurerm_eventhub_namespace.eventhub_mil: Reading...
data.azurerm_kubernetes_cluster.aks: Reading...
data.azurerm_dns_zone.public: Read complete after 1s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-vnet-rg/providers/Microsoft.Network/dnsZones/dev.cstar.pagopa.it]
data.azurerm_monitor_action_group.slack: Reading...
data.azurerm_key_vault.kv_domain: Read complete after 0s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-mil-sec-rg/providers/Microsoft.KeyVault/vaults/cstar-d-weu-mil-kv]
data.azurerm_subscription.current: Reading...
data.azurerm_api_management.apim_core: Reading...
data.azurerm_private_dns_zone.internal: Read complete after 0s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-vnet-rg/providers/Microsoft.Network/privateDnsZones/internal.dev.cstar.pagopa.it]
data.azurerm_application_insights.application_insights: Reading...
data.azurerm_subscription.current: Read complete after 0s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d]
azurerm_key_vault_secret.azure_devops_sa_cacrt: Refreshing state... [id=https://cstar-d-weu-mil-kv.vault.azure.net/secrets/cstar-d-weu-dev01-aks-azure-devops-sa-cacrt/ef25497a504c42bb9e54e5a9caca4aad]
data.azurerm_monitor_action_group.email: Read complete after 1s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-monitor-rg/providers/Microsoft.Insights/actionGroups/PagoPA]
azurerm_key_vault_secret.azure_devops_sa_token: Refreshing state... [id=https://cstar-d-weu-mil-kv.vault.azure.net/secrets/cstar-d-weu-dev01-aks-azure-devops-sa-token/3746c1b906624b129bb2671e930f6619]
data.azurerm_api_management.apim_core: Read complete after 1s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim]
module.pod_identity.null_resource.create_pod_identity: Refreshing state... [id=5970510449316808309]
module.workload_identity.azurerm_key_vault_secret.workload_identity_service_account_name[0]: Refreshing state... [id=https://cstar-d-weu-mil-kv.vault.azure.net/secrets/mil-poc-workload-identity-service-account-name/fc06434e77e84d7881cfd6d4e7415394]
data.azurerm_application_insights.application_insights: Read complete after 1s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-monitor-rg/providers/Microsoft.Insights/components/cstar-d-appinsights]
azurerm_api_management_policy_fragment.apim-validate-token-mil: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/policyFragments/emd-validate-token-mil]
data.azurerm_monitor_action_group.slack: Read complete after 1s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-monitor-rg/providers/Microsoft.Insights/actionGroups/SlackPagoPA]
module.pod_identity.azurerm_key_vault_access_policy.this[0]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-mil-sec-rg/providers/Microsoft.KeyVault/vaults/cstar-d-weu-mil-kv/objectId/3808f73f-984b-402d-955e-bbd3c8bba77d]
azurerm_key_vault_secret.appinsights-instrumentation-key: Refreshing state... [id=https://cstar-d-weu-mil-kv.vault.azure.net/secrets/appinsights-instrumentation-key/5b22eaf1f9004a1c891e6584ffe9300d]
data.azurerm_log_analytics_workspace.log_analytics: Read complete after 1s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-monitor-rg/providers/Microsoft.OperationalInsights/workspaces/cstar-d-law]
module.emd_api_product.azurerm_api_management_product.this: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/emd_api_product]
data.azurerm_eventhub_namespace.eventhub_mil: Read complete after 1s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-mil-evh-rg/providers/Microsoft.EventHub/namespaces/cstar-d-weu-mil-evh]
module.emd_message_core.azurerm_api_management_api.this: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-message-core;rev=1]
kubernetes_config_map.emd-eventhub: Refreshing state... [id=mil/emd-eventhub]
module.emd_api_product.azurerm_api_management_product_policy.this[0]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/emd_api_product]
module.emd_api_product.azurerm_api_management_product_group.this["developers"]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/emd_api_product/groups/developers]
module.emd_message_core.azurerm_api_management_api_policy.this[0]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-message-core]
module.emd_message_core.azurerm_api_management_api_operation_policy.api_operation_policy["submitMessage"]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-message-core/operations/submitMessage]
module.emd_message_core.azurerm_api_management_product_api.this["emd_api_product"]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/emd_api_product/apis/d-emd-message-core]
data.azurerm_kubernetes_cluster.aks: Read complete after 2s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-dev01-aks-rg/providers/Microsoft.ContainerService/managedClusters/cstar-d-weu-dev01-aks]
module.workload_identity.data.azurerm_user_assigned_identity.this: Reading...
data.azurerm_resources.aks_mc_rg: Reading...
azurerm_key_vault_secret.aks_apiserver_url: Refreshing state... [id=https://cstar-d-weu-mil-kv.vault.azure.net/secrets/cstar-d-weu-dev01-aks-apiserver-url/7c013a3f89b846fcbc079cb682b876de]
module.workload_identity.data.azurerm_kubernetes_cluster.aks: Reading...
data.azurerm_resources.aks_mc_rg: Read complete after 0s [id=resource-a519e7e5-6050-448b-9096-0cd3f7a92f8b]
module.workload_identity.data.azurerm_user_assigned_identity.this: Read complete after 0s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-dev01-aks-rg/providers/Microsoft.ManagedIdentity/userAssignedIdentities/mil-poc-workload-identity]
module.workload_identity.azurerm_key_vault_secret.workload_identity_client_id[0]: Refreshing state... [id=https://cstar-d-weu-mil-kv.vault.azure.net/secrets/mil-poc-workload-identity-client-id/7628af5a4d314d50866b5ad2b12d8dbf]
module.workload_identity.azurerm_key_vault_access_policy.this[0]: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-mil-sec-rg/providers/Microsoft.KeyVault/vaults/cstar-d-weu-mil-kv/objectId/2abc7984-9d68-4b88-816f-b33369b9c025]
module.workload_identity.kubernetes_service_account_v1.workload_identity_sa[0]: Refreshing state... [id=mil/mil-poc-workload-identity]
module.workload_identity.data.azurerm_kubernetes_cluster.aks: Read complete after 1s [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-dev01-aks-rg/providers/Microsoft.ContainerService/managedClusters/cstar-d-weu-dev01-aks]
module.workload_identity.azurerm_federated_identity_credential.workload_identity_federation: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-dev01-aks-rg/providers/Microsoft.ManagedIdentity/userAssignedIdentities/mil-poc-workload-identity/federatedIdentityCredentials/mil-poc-workload-identity]
module.cert_mounter.helm_release.cert_mounter: Refreshing state... [id=cert-mounter-blueprint]
module.tls_checker.helm_release.helm_this[0]: Refreshing state... [id=chckr-mil-weu-internal-dev-cstar-pagopa-it75454]
module.tls_checker.azurerm_monitor_metric_alert.alert_this: Refreshing state... [id=/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-monitor-rg/providers/Microsoft.Insights/metricAlerts/mil-weu-internal-dev-cstar-pagopa-it]

Terraform used the selected providers to generate the following execution
plan. Resource actions are indicated with the following symbols:
  ~ update in-place
  - destroy

Terraform will perform the following actions:

  # azurerm_api_management_api.auth will be destroyed
  # (because azurerm_api_management_api.auth is not in configuration)
  - resource "azurerm_api_management_api" "auth" {
      - api_management_name   = "cstar-d-apim" -> null
      - api_type              = "http" -> null
      - description           = "Authorization Microservice for Multi-channel Integration Layer of SW Client Project" -> null
      - display_name          = "MIL AUTH API" -> null
      - id                    = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/cstar-d-weu-mil-auth;rev=1" -> null
      - is_current            = true -> null
      - is_online             = false -> null
      - name                  = "cstar-d-weu-mil-auth" -> null
      - path                  = "mil-auth" -> null
      - protocols             = [
          - "https",
        ] -> null
      - resource_group_name   = "cstar-d-api-rg" -> null
      - revision              = "1" -> null
      - service_url           = "https://mil.weu.internal.dev.cstar.pagopa.it/milauth" -> null
      - soap_pass_through     = false -> null
      - subscription_required = false -> null
        # (5 unchanged attributes hidden)

      - import {
          - content_format = "openapi-link" -> null
          - content_value  = "https://raw.githubusercontent.com/pagopa/mil-auth/main/src/main/resources/META-INF/openapi.yaml" -> null
        }

      - subscription_key_parameter_names {
          - header = "Ocp-Apim-Subscription-Key" -> null
          - query  = "subscription-key" -> null
        }
    }

  # azurerm_api_management_api.papos will be destroyed
  # (because azurerm_api_management_api.papos is not in configuration)
  - resource "azurerm_api_management_api" "papos" {
      - api_management_name   = "cstar-d-apim" -> null
      - api_type              = "http" -> null
      - description           = "PA POS Microservice for MIL Multi-channel Integration Layer of SW Client Project" -> null
      - display_name          = "MIL PAPOS API" -> null
      - id                    = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/cstar-d-weu-mil-papos;rev=1" -> null
      - is_current            = true -> null
      - is_online             = false -> null
      - name                  = "cstar-d-weu-mil-papos" -> null
      - path                  = "mil-papos" -> null
      - protocols             = [
          - "https",
        ] -> null
      - resource_group_name   = "cstar-d-api-rg" -> null
      - revision              = "1" -> null
      - service_url           = "https://mil.weu.internal.dev.cstar.pagopa.it/milpapos" -> null
      - soap_pass_through     = false -> null
      - subscription_required = false -> null
        # (5 unchanged attributes hidden)

      - import {
          - content_format = "openapi" -> null
          - content_value  = <<-EOT
                openapi: 3.0.3
                
                info:
                  title: PA POS Microservice
                  version: 2.0.0
                  description: Public Administration POS of Multi-channel Project
                  contact:
                    name: Antonio Tarricone
                    email: antonio.tarricone@pagopa.it
                
                servers:
                  - description: Development Test
                    url: https://api.dev.cstar.pagopa.it/mil-papos
                    x-internal: true
                  - description: User Acceptance Test
                    url: https://api.uat.cstar.pagopa.it/mil-papos
                    x-internal: true
                
                tags:
                  - name: terminals
                    description: Terminals management operation
                  - name: transactions
                    description: Transactions management operation
                  - name: solutions
                    description: Solutions management operation
                  - name: pa
                    description: Operation which can be invoked by Public Administration (the payee) Portal
                  - name: pos
                    description: Operation which can be invoked by POS (through a back-end)
                  - name: psp
                    description: Operation which can be invoked by POS PSP
                  - name: admin
                    description: Operation which can be invoked by the Administrator to configure the system
                
                paths:
                  /solutions:
                    parameters:
                      - $ref: '#/components/parameters/RequestId'
                    
                    post:
                      operationId: createSolution
                      description: Creates a solution
                      tags: [ solutions, admin ]
                      security:
                        - oAuth2: [ mil_papos_admin ]
                      requestBody:
                        $ref: '#/components/requestBodies/CreateOrUpdateSolution'
                      responses:
                        "201":
                          #description: Created
                          $ref: '#/components/responses/CreateSolution'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "415":
                          #description: Unsupported media type. Did you provide application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many requests
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                    
                    get:
                      operationId: getSolutions
                      description: Returns all solutions
                      tags: [ solutions, admin ]
                      security:
                        - oAuth2: [ mil_papos_admin ]
                      parameters:
                        - $ref: '#/components/parameters/PageNumber'
                        - $ref: '#/components/parameters/PageSize'
                      responses:
                        "200":
                          #description: Ok
                          $ref: '#/components/responses/PageOfSolutions'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many request
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                  
                  /solutions/findByPspId:
                    parameters:
                      - $ref: '#/components/parameters/RequestId'
                   
                    get:
                      operationId: getSolutionByPsp
                      description: Returns all solutions for a given PSP
                      tags: [ solutions, admin, psp ]
                      security:
                        - oAuth2: [ mil_papos_admin, pos_service_provider ]
                      parameters:
                        - $ref: '#/components/parameters/PspId'
                        - $ref: '#/components/parameters/PageNumber'
                        - $ref: '#/components/parameters/PageSize'
                      responses:
                        "200":
                          #description: Ok
                          $ref: '#/components/responses/PageOfSolutions'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many request
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                  
                  /solutions/findByLocationCode:
                    parameters:
                      - $ref: '#/components/parameters/RequestId'
                    
                    get:
                      operationId: getSolutionsByLocationCode
                      description: Returns all solutions for a given LocationCode
                      tags: [ solutions, admin, pa ]
                      security:
                        - oAuth2: [ mil_papos_admin, public_administration ]
                      parameters:
                        - $ref: '#/components/parameters/LocationCode'
                        - $ref: '#/components/parameters/PageNumber'
                        - $ref: '#/components/parameters/PageSize'
                      responses:
                        "200":
                          #description: Ok
                          $ref: '#/components/responses/PageOfSolutions'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many request
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                          
                  /solutions/{solutionId}:
                    parameters:
                      - $ref: '#/components/parameters/RequestId'
                      - $ref: '#/components/parameters/SolutionId'
                    
                    get:
                      operationId: getSolution
                      description: Returns a solution
                      tags: [ solutions, admin ]
                      security:
                        - oAuth2: [ mil_papos_admin ]
                      responses:
                        "200":
                          #description: Ok
                          $ref: '#/components/responses/Solution'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many request
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                    
                    put:
                      operationId: updateSolution
                      description: Updates a solution
                      tags: [ solutions, admin ]
                      security:
                        - oAuth2: [ mil_papos_admin ]
                      requestBody:
                        $ref: '#/components/requestBodies/CreateOrUpdateSolution'
                      responses:
                        "204":
                          #description: No content
                          $ref: '#/components/responses/NoContent'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "404":
                          #description: Not found
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "415":
                          #description: Unsupported media type. Did you provide application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many requests
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                    
                    delete:
                      operationId: deleteSolution
                      description: Deletes a solution
                      tags: [ solutions, admin ]
                      security:
                        - oAuth2: [ mil_papos_admin ]
                      responses:
                        "204":
                          #description: No content
                          $ref: '#/components/responses/NoContent'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "404":
                          #description: Not found
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many requests
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                  /terminals:
                    post:
                      operationId: createTerminal
                      description: Creates a new terminal
                      tags: [ terminals, psp ]
                      security:
                        - oAuth2: [ pos_service_provider ]
                      parameters:
                        - $ref: '#/components/parameters/RequestId'
                      requestBody:
                        $ref: '#/components/requestBodies/CreateOrUpdateTerminal'
                      responses:
                        "201":
                          #description: Created
                          $ref: '#/components/responses/CreateTerminal'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "409":
                          #description: Already exists
                          $ref: '#/components/responses/Error'
                        "415":
                          #description: Unsupported media type. Did you provide application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many requests
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                  /terminals/bulkload:
                    post:
                      operationId: bulkLoadTerminals
                      description: Allows the bulk loading of a set of terminals.
                      tags: [ terminals, psp ]
                      security:
                        - oAuth2: [ pos_service_provider ]
                      parameters:
                        - $ref: '#/components/parameters/RequestId'
                      requestBody:
                        $ref: '#/components/requestBodies/BulkLoadTerminals'
                      responses:
                        "202":
                          #description: Accepted
                          $ref: '#/components/responses/BulkLoadTerminals'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "409":
                          #description: Already exists
                          $ref: '#/components/responses/Error'
                        "415":
                          #description: Unsupported media type
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many requests
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                  /terminals/bulkload/{bulkLoadingId}:
                    get:
                      operationId: getBulkLoadingStatusFile
                      description: Returns a file with the status of bulk loading operation
                      tags: [ terminals, psp ]
                      security:
                        - oAuth2: [ pos_service_provider ]
                      parameters:
                        - $ref: '#/components/parameters/RequestId'
                        - $ref: '#/components/parameters/BulkLoadingId'
                      responses:
                        "200":
                          #description: Returns the report of bulk loading operation
                          $ref: '#/components/responses/BulkLoadingReport'
                        "202":
                          #description: Bulk loading still in progress
                          $ref: '#/components/responses/NoContent'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many request
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                  /terminals/findByPayeeCode:
                    get:
                      operationId: getTerminalListByPayeeCode
                      description: Returns a page of terminals
                      tags: [ terminals, pa ]
                      security:
                        - oAuth2: [ public_administration ]
                      parameters:
                        - $ref: '#/components/parameters/RequestId'
                        - $ref: '#/components/parameters/PayeeCode'
                        - $ref: '#/components/parameters/PageNumber'
                        - $ref: '#/components/parameters/PageSize'
                      responses:
                        "200":
                          #description: Ok
                          $ref: '#/components/responses/PageOfTerminalsWithWorkstations'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many request
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                  /terminals/findByPspId:
                    get:
                      operationId: getTerminalListByPspId
                      description: Returns a page of terminals
                      tags: [ terminals, psp ]
                      security:
                        - oAuth2: [ pos_service_provider ]
                      parameters:
                        - $ref: '#/components/parameters/RequestId'
                        - $ref: '#/components/parameters/PspId'
                        - $ref: '#/components/parameters/PageNumber'
                        - $ref: '#/components/parameters/PageSize'
                      responses:
                        "200":
                          #description: Ok
                          $ref: '#/components/responses/PageOfTerminals'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many request
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                  /terminals/findByWorkstation:
                    get:
                      operationId: findTerminalsByWorkstation
                      description: Returns the list of terminals linked to a cash desk
                      tags: [ terminals, pa ]
                      security:
                        - oAuth2: [ public_administration ]
                      parameters:
                        - $ref: '#/components/parameters/RequestId'
                        - $ref: '#/components/parameters/PayeeCode'
                        - $ref: '#/components/parameters/Workstation'
                      responses:
                        "200":
                          #description: Ok
                          $ref: '#/components/responses/TerminalsWithWorkstations'
                        "400":
                          #description: Bad request 
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many request
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                  /terminals/{terminalUuid}/updateWorkstations:
                    patch:
                      operationId: updateWorkstations
                      description: Updates the list of cash desks linked to the terminal
                      tags: [ terminals, pa ]
                      security:
                        - oAuth2: [ public_administration ]
                      parameters:
                        - $ref: '#/components/parameters/RequestId'
                        - $ref: '#/components/parameters/TerminalUuid'
                      requestBody:
                        $ref: '#/components/requestBodies/UpdateWorkstations'
                      responses:
                        "204":
                          #description: No content
                          $ref: '#/components/responses/NoContent'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "404":
                          #description: Not found
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "415":
                          #description: Unsupported media type. Did you provide application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many requests
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                  /terminals/{terminalUuid}:
                    parameters:
                      - $ref: '#/components/parameters/RequestId'
                      - $ref: '#/components/parameters/TerminalUuid'
                
                    patch:
                      operationId: updateTerminal
                      description: Updated terminal without modify linked cash desks
                      tags: [ terminals, psp ]
                      security:
                        - oAuth2: [ pos_service_provider ]
                      requestBody:
                        $ref: '#/components/requestBodies/CreateOrUpdateTerminal'
                      responses:
                        "204":
                          #description: No content
                          $ref: '#/components/responses/NoContent'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "404":
                          #description: Not found
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "415":
                          #description: Unsupported media type. Did you provide application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many requests
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                    delete:
                      operationId: deleteTerminal
                      description: Deletes a terminal
                      tags: [ terminals, psp ]
                      security:
                        - oAuth2: [ pos_service_provider ]
                      responses:
                        "204":
                          #description: No content
                          $ref: '#/components/responses/NoContent'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "404":
                          #description: Not found
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many requests
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                  /transactions:
                    post:
                      operationId: create
                      summary: Creates a transaction
                      description: Create a transaction from Public Administration (the payee) Portal
                      tags: [ transactions, pa ]
                      security:
                        - oAuth2: [ public_administration ]
                      parameters:
                        - $ref: '#/components/parameters/RequestId'
                      requestBody:
                        $ref: '#/components/requestBodies/CreateTransaction'
                      responses:
                        "204":
                          #description: No content
                          $ref: '#/components/responses/CreateTransaction'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "415":
                          #description: Unsupported media type. Did you provide application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many request
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                  /transactions/findByPayeeCode:
                    get:
                      operationId: getTransactionsByPayeeCode
                      summary: Retrieves the list of transactions
                      description: Retrieves the list of transactions by payee
                      tags: [ transactions, pa ]
                      security:
                        - oAuth2: [ public_administration ]
                      parameters:
                        - $ref: '#/components/parameters/RequestId'
                        - $ref: '#/components/parameters/PayeeCode'
                        - $ref: '#/components/parameters/StartDate'
                        - $ref: '#/components/parameters/EndDate'
                        - $ref: '#/components/parameters/SortStrategy'
                        - $ref: '#/components/parameters/PageNumber'
                        - $ref: '#/components/parameters/PageSize'
                      responses:
                        "200":
                          #description: Found
                          $ref: '#/components/responses/PageOfTransactions'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many request
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                  /transactions/findByPspId:
                    get:
                      operationId: getTransactionsByPspId
                      summary: Retrieves the list of transactions
                      description: Retrieves the list of transactions by PSP
                      tags: [ transactions, psp ]
                      security:
                        - oAuth2: [ pos_service_provider ]
                      parameters:
                        - $ref: '#/components/parameters/RequestId'
                        - $ref: '#/components/parameters/PspId'
                        - $ref: '#/components/parameters/StartDate'
                        - $ref: '#/components/parameters/EndDate'
                        - $ref: '#/components/parameters/SortStrategy'
                        - $ref: '#/components/parameters/PageNumber'
                        - $ref: '#/components/parameters/PageSize'
                      responses:
                        "200":
                          #description: Found
                          $ref: '#/components/responses/PageOfTransactions'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many request
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                  /transactions/{transactionId}:
                    parameters:
                      - $ref: '#/components/parameters/RequestId'
                      - $ref: '#/components/parameters/TransactionId'
                
                    delete:
                      operationId: deleteTransaction
                      summary: Deletes a transaction
                      description: Allows a Public Administration (the payee) Portal to delete a transaction
                      tags: [ transactions, pa ]
                      security:
                        - oAuth2: [ public_administration ]
                      responses:
                        "204":
                          #description: No content
                          $ref: '#/components/responses/NoContent'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "404":
                          #description: Not found
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many requests
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                    patch:
                      operationId: updateTransaction
                      description: Updates amount and status of a transaction
                      tags: [ transactions, pa ]
                      security:
                        - oAuth2: [ public_administration ]
                      requestBody:
                        $ref: '#/components/requestBodies/UpdateTransaction'
                      responses:
                        "204":
                          #description: No content
                          $ref: '#/components/responses/NoContent'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "404":
                          #description: Not found
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "415":
                          #description: Unsupported media type. Did you provide application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many requests
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                    get:
                      operationId: getTransaction
                      description: Returns transaction data
                      tags: [ transactions, pa, psp ]
                      security:
                        - oAuth2: [ public_administration, pos_service_provider ]
                      responses:
                        "200":
                          #description: Ok
                          $ref: '#/components/responses/Transaction'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "404":
                          #description: Not found
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many requests
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                  /transactions/latest:
                    get:
                      operationId: getLatestTransaction
                      summary: Retrieves the latest transaction
                      description: Retrieves the latest transaction by POS and status
                      tags: [ transactions, pos ]
                      security:
                        - oAuth2: [ pos_service_provider ]
                      parameters:
                        - $ref: '#/components/parameters/RequestId'
                        - $ref: '#/components/parameters/PspId'
                        - $ref: '#/components/parameters/TerminalId'
                        - $ref: '#/components/parameters/Status'
                      responses:
                        "200":
                          #description: Found
                          $ref: '#/components/responses/Transaction'
                        "400":
                          #description: Bad request
                          $ref: '#/components/responses/Error'
                        "401":
                          #description: Access token is missing or invalid
                          $ref: '#/components/responses/Error'
                        "403":
                          #description: Forbidden
                          $ref: '#/components/responses/Error'
                        "404":
                          #description: Not found
                          $ref: '#/components/responses/Error'
                        "406":
                          #description: Not acceptable. Did you require application/json?
                          $ref: '#/components/responses/Error'
                        "429":
                          #description: Too many request
                          $ref: '#/components/responses/Error'
                        "500":
                          #description: Server error
                          $ref: '#/components/responses/Error'
                        default:
                          description: Unexpected error
                
                components:
                  # ========================================================
                  # Schemas
                  # ========================================================
                  schemas:
                    # ------------------------------------------------------
                    # Basic types
                    # ------------------------------------------------------
                    AccessControlAllowOrigin:
                      description: Indicates whether the response can be shared with requesting code from the given origin
                      type: string
                      pattern: "^[ -~]{1,2048}$"
                      minLength: 1
                      maxLength: 2048
                
                    BulkLoadingLocation:
                      description: URL to get the status of bulk loading operation
                      type: string
                      format: uri
                      pattern: "^[ -~]{1,2048}$"
                      minLength: 1
                      maxLength: 2048
                      example: "https://mil-d-apim.azure-api.net/mil-papos/terminals/bulkload/4658fcb36e520a65b1be79d0"
                
                    BulkLoadingId:
                      description: ID of a bulk loading operation
                      type: string
                      pattern: "^[0-9a-f]{24}$"
                      minLength: 24
                      maxLength: 24
                      example: "c7a1b24b0583477292ebdbaa"
                
                    Enabled:
                      description: True if the terminal is enabled
                      type: boolean
                      example: true
                
                    ErrorCode:
                      description: Error code
                      type: string
                      pattern: "^[A-F0-9]{9}$"
                      minLength: 9
                      maxLength: 9
                      example: "001000005"
                
                    ErrorDescription:
                      description: Error description
                      type: string
                      pattern: "^[ -~]{1,256}$"
                      minLength: 1
                      maxLength: 256
                      example: "Unexpected error from server"
                
                    EuroCents:
                      description: Amount in euro cents
                      type: integer
                      format: int64
                      minimum: 1
                      maximum: 99999999999
                      example: 12345
                
                    LocationCode:
                      description: Fiscal code of the subject that held the terminal
                      type: string
                      pattern: "^\\d{11}$"
                      minLength: 11
                      maxLength: 11
                      example: "06534340721"
                
                    NoticeNumber:
                      description: Notice number
                      type: string
                      pattern: "^[0-9]{18}$"
                      minLength: 18
                      maxLength: 18
                      example: "485564829563528563"
                    
                    PageNumber:
                      description: Number of the page
                      type: integer
                      format: int32
                      minimum: 0
                      maximum: 2147483647
                      example: 1
                
                    PageSize:
                      description: Size of the page
                      type: integer
                      format: int32
                      minimum: 1
                      maximum: 128
                      example: 20
                
                    PayeeCode:
                      description: Fiscal code of the subject that receives the payment
                      type: string
                      pattern: "^\\d{11}$"
                      minLength: 11
                      maxLength: 11
                      example: "06534340721"
                
                    PspId:
                      description: ID of the POS service provider
                      type: string
                      pattern: "^[ -~]{1,64}$"
                      minLength: 1
                      maxLength: 64
                      example: "AGID_01"
                
                    RateLimitLimit:
                      description: The number of allowed requests in the current period
                      type: integer
                      format: int32
                      minimum: 1
                      maximum: 240
                
                    RateLimitReset:
                      description: The number of seconds left in the current period
                      type: integer
                      format: int32
                      minimum: 1
                      maximum: 60
                
                    RetryAfter:
                      description: The number of seconds to wait before allowing a follow-up request
                      type: integer
                      format: int32
                      minimum: 1
                      maximum: 240
                    
                    SolutionId:
                      description: Solution ID
                      type: string
                      pattern: "^[0-9a-f]{24}$"
                      minLength: 24
                      maxLength: 24
                      example: "2f6a6bbe78904acef70345ca"
                    
                    SolutionLocation:
                      description: URL of the solution
                      type: string
                      format: uri
                      pattern: "^[ -~]{1,2048}$"
                      minLength: 1
                      maxLength: 2048
                      example: "https://mil-d-apim.azure-api.net/mil-papos/solutions/2f6a6bbe78904acef70345ca"
                    
                    Status:
                      description: Status of the transaction
                      type: string
                      enum:
                        - CLOSED_OK
                        - ERROR_ON_PAYMENT
                        - ABORT
                        - CREATED
                      example: "CLOSED_OK"
                    
                    TerminalId:
                      description: ID of the terminal for the PSP
                      type: string
                      pattern: "^\\d{4,12}$"
                      minLength: 4
                      maxLength: 12
                      example: "34523860"
                
                    TerminalLocation:
                      description: URL of the terminal
                      type: string
                      format: uri
                      pattern: "^[ -~]{1,2048}$"
                      minLength: 1
                      maxLength: 2048
                      example: "https://mil-d-apim.azure-api.net/mil-papos/terminals/c7a1b24b0583477292ebdbaa"
                
                    TerminalUuid:
                      description: UUID of a terminal for this layer
                      type: string
                      pattern: "^[0-9a-f]{24}$"
                      minLength: 24
                      maxLength: 24
                      example: "c7a1b24b0583477292ebdbaa"
                
                    Timestamp:
                      description: Timestamp (ex. 2024-03-06T13:15:54Z, 2024-03-06T14:15:54+01:00)
                      type: string
                      format: date-time
                      pattern: "^\\d{4}\\-\\d{2}\\-\\d{2}T\\d{2}:\\d{2}:\\d{2}(Z|(\\+|\\-)\\d{2}:\\d{2})$"
                      minLength: 20
                      maxLength: 25
                      example: "2024-03-06T14:15:54+01:00"
                
                    TransactionId:
                      description: Transaction ID for this layer
                      type: string
                      pattern: "^[0-9a-f]{24}$"
                      minLength: 24
                      maxLength: 24
                      example: "4658fcb36e520a65b1be79d0"
                
                    TransactionLocation:
                      description: URL of the transaction
                      type: string
                      format: uri
                      pattern: "^[ -~]{1,2048}$"
                      minLength: 1
                      maxLength: 2048
                      example: "https://mil-d-apim.azure-api.net/mil-papos/transactions/4658fcb36e520a65b1be79d0"
                
                    UUID:
                      description: UUID
                      type: string
                      pattern: "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"
                      minLength: 36
                      maxLength: 36
                      example: "d0d654e6-97da-4848-b568-99fedccb642b"
                
                    Workstation:
                      description: Label indicating the cash desk that can use a terminal
                      type: string
                      pattern: "^[ -~]{1,64}$"
                      minLength: 1
                      maxLength: 64
                      example: "cassa-1-ufficio-3"
                
                    # ------------------------------------------------------
                    # Complex types
                    # ------------------------------------------------------
                    CreateOrUpdateSolution:
                      description: Request to create or update a solution
                      type: object
                      additionalProperties: false
                      properties:
                        pspId:
                          $ref: '#/components/schemas/PspId'
                        locationCode:
                          $ref: '#/components/schemas/LocationCode'
                      required:
                        - pspId
                        - locationCode
                      example:
                        pspId: "AGID_01"
                        locationCode: "06534340721"
                        
                    CreateOrUpdateTerminal:
                      description: Request to create or update a terminal by PSP
                      type: object
                      additionalProperties: false
                      properties:
                        solutionId:
                          $ref: '#/components/schemas/SolutionId'
                        terminalId:
                          $ref: '#/components/schemas/TerminalId'
                        enabled:
                          $ref: '#/components/schemas/Enabled'
                      required:
                        - solutionId
                        - terminalId
                        - enabled
                      example:
                        solutionId: "2f6a6bbe78904acef70345ca"
                        terminalId: "34523860"
                        enabled: true
                
                    CreateTransaction:
                      description: Request to create a transaction from Public Administration (the payee) Portal
                      type: object
                      additionalProperties: false
                      properties:
                        terminalUuid:
                          $ref: '#/components/schemas/TerminalUuid'
                        noticeNumber:
                          $ref: '#/components/schemas/NoticeNumber'
                        payeeCode:
                          $ref: '#/components/schemas/PayeeCode'
                      required:
                        - terminalUuid
                        - noticeNumber
                        - payeeCode
                      example:
                        terminalUuid: "c7a1b24b0583477292ebdbaa"
                        noticeNumber: "485564829563528563"
                        payeeCode: "06534340721"
                    
                    Error:
                      description: Error details
                      type: object
                      additionalProperties: false
                      properties:
                        code:
                          $ref: '#/components/schemas/ErrorCode'
                        description:
                          $ref: '#/components/schemas/ErrorDescription'
                      required:
                        - code
                        - description
                      example:
                        code: "001000001"
                        description: "Generic error"
                
                    Errors:
                      description: List of errors
                      type: object
                      additionalProperties: false
                      properties:
                        errors:
                          type: array
                          minItems: 1
                          maxItems: 32
                          items:
                            $ref: '#/components/schemas/Error'
                      required:
                        - errors
                      example:
                        errors:
                          - code: "00000000A"
                            description: "Generic error"
                          - code: "001000001"
                            description: "Unexpected error from server"
                
                    PageMetadata:
                      description: Metadata of a page of data
                      type: object
                      additionalProperties: false
                      properties:
                        size:
                          $ref: '#/components/schemas/PageSize'
                        totalElements:
                          description: Total number of items
                          type: integer
                          format: int32
                          minimum: 0
                          maximum: 2147483647
                          example: 200
                        totalPages:
                          $ref: '#/components/schemas/PageNumber'
                      example:
                        size: 20
                        totalElements: 100
                        totalPages: 5
                
                    PageOfSolutions:
                      description: Page of solutions
                      allOf:
                        - type: object
                          additionalProperties: false
                          properties:
                            solutions:
                              $ref: '#/components/schemas/Solutions'
                          required:
                            - solutions
                        - type: object
                          additionalProperties: false
                          properties:
                            page:
                              $ref: '#/components/schemas/PageMetadata'
                          required:
                            - page
                      example:
                        solutions:
                          - solutionId: "2f6a6bbe78904acef70345ca"
                            pspId: "AGID_01"
                            locationCode: "06534340721"
                        page:
                          size: 1
                          totalElements: 1
                          totalPages: 1
                    
                    PageOfTerminals:
                      description: Page of terminals data
                      allOf:
                        - $ref: '#/components/schemas/Terminals'
                        - type: object
                          additionalProperties: false
                          properties:
                            page:
                              $ref: '#/components/schemas/PageMetadata'
                          required:
                            - page
                      example:
                        terminals:
                          - terminalUuid: "c7a1b24b0583477292ebdbaa"
                            solutionId: "2f6a6bbe78904acef70345ca"
                            terminalId: "34523860"
                            enabled: true
                          - terminalUuid: "635edc54ab35f303668bbe7e"
                            solutionId: "2f6a6bbe78904acef70345ca"
                            terminalId: "34523865"
                            enabled: true
                        page:
                          size: 2
                          totalElements: 5
                          totalPages: 3
                
                    PageOfTerminalsWithWorkstations:
                      description: Page of terminals data
                      allOf:
                        - $ref: '#/components/schemas/TerminalsWithWorkstations'
                        - type: object
                          additionalProperties: false
                          properties:
                            page:
                              $ref: '#/components/schemas/PageMetadata'
                          required:
                            - page
                      example:
                        terminals:
                          - terminalUuid: "c7a1b24b0583477292ebdbaa"
                            solutionId: "2f6a6bbe78904acef70345ca"
                            terminalId: "34523860"
                            enabled: true
                            workstations:
                              - "cassa-1-ufficio-3"
                              - "cassa-2-ufficio-3"
                          - terminalUuid: "635edc54ab35f303668bbe7e"
                            solutionId: "2f6a6bbe78904acef70345ca"
                            terminalId: "34523865"
                            enabled: true
                            workstations:
                              - "cassa-3-ufficio-3"
                              - "cassa-4-ufficio-3"
                        page:
                          size: 2
                          totalElements: 5
                          totalPages: 3
                
                    PageOfTransactions:
                      description: Page of transactions
                      allOf:
                        - type: object
                          additionalProperties: false
                          properties:
                            transactions:
                              $ref: '#/components/schemas/Transactions'
                          required:
                            - transactions
                        - type: object
                          additionalProperties: false
                          properties:
                            page:
                              $ref: '#/components/schemas/PageMetadata'
                          required:
                            - page
                      example:
                        transactions:
                          - id: "4658fcb36e520a65b1be79d0"
                            terminalUuid: "AGID_01"
                            noticeNumber: "485564829563528563"
                            payeeCode: "06534340721"
                            creationTimestamp: "2024-03-06T13:15:54Z"
                            lastUpdateTimestamp: "2024-03-06T13:16:33Z"
                            status: "CLOSED_OK"
                            amount: 12345
                        page:
                          size: 1
                          totalElements: 5
                          totalPages: 5
                    
                    Solution:
                      description: Represents a solution which is made up of Public administration and a PSP and carries the configuration to connect the service used by the Payee
                      type: object
                      additionalProperties: false
                      properties:
                        solutionId:
                          $ref: '#/components/schemas/SolutionId'
                        pspId:
                          $ref: '#/components/schemas/PspId'
                        locationCode:
                          $ref: '#/components/schemas/LocationCode'
                      required:
                        - solutionId
                        - pspId
                        - locationCode
                      example:
                        solutionId: "2f6a6bbe78904acef70345ca"
                        pspId: "AGID_01"
                        locationCode: "06534340721"
                    
                    Solutions:
                      description: List of solutions
                      type: array
                      minItems: 0
                      maxItems: 128
                      items:
                        $ref: '#/components/schemas/Solution'
                      example:
                        - solutionId: "2f6a6bbe78904acef70345ca"
                          pspId: "AGID_01"
                          locationCode: "06534340721"
                    
                    Terminal:
                      description: Data of a terminal
                      type: object
                      additionalProperties: false
                      properties:
                        terminalUuid:
                          $ref: '#/components/schemas/TerminalUuid'
                        solutionId:
                          $ref: '#/components/schemas/SolutionId'
                        terminalId:
                          $ref: '#/components/schemas/TerminalId'
                        enabled:
                          $ref: '#/components/schemas/Enabled'
                      required:
                        - terminalUuid
                        - solutionId
                        - terminalId
                        - enabled
                      example:
                        terminalUuid: "c7a1b24b0583477292ebdbaa"
                        solutionId: "2f6a6bbe78904acef70345ca"
                        terminalId: "34523860"
                        enabled: true
                    
                    TerminalWithWorkstations:
                      description: Data of a terminal
                      type: object
                      additionalProperties: false
                      properties:
                        terminalUuid:
                          $ref: '#/components/schemas/TerminalUuid'
                        solutionId:
                          $ref: '#/components/schemas/SolutionId'
                        terminalId:
                          $ref: '#/components/schemas/TerminalId'
                        enabled:
                          $ref: '#/components/schemas/Enabled'
                        workstations:
                          $ref: '#/components/schemas/WorkstationsArray'
                      required:
                        - terminalUuid
                        - solutionId
                        - terminalId
                        - enabled
                        - workstations
                      example:
                        terminalUuid: "c7a1b24b0583477292ebdbaa"
                        solutionId: "2f6a6bbe78904acef70345ca"
                        terminalId: "34523860"
                        enabled: true
                        workstations:
                          - "cassa-1-ufficio-3"
                          - "cassa-2-ufficio-3"
                
                    Terminals:
                      description: List of terminals
                      type: object
                      additionalProperties: false
                      properties:
                        terminals:
                          type: array
                          minItems: 0
                          maxItems: 64
                          items:
                            $ref: '#/components/schemas/Terminal'
                      required:
                        - terminals
                      example:
                        terminals:
                          - terminalUuid: "c7a1b24b0583477292ebdbaa"
                            solutionId: "2f6a6bbe78904acef70345ca"
                            terminalId: "34523860"
                            enabled: true
                          - terminalUuid: "635edc54ab35f303668bbe7e"
                            solutionId: "2f6a6bbe78904acef70345ca"
                            terminalId: "34523865"
                            enabled: true
                
                    TerminalsWithWorkstations:
                      description: List of terminals
                      type: object
                      additionalProperties: false
                      properties:
                        terminals:
                          type: array
                          minItems: 0
                          maxItems: 64
                          items:
                            $ref: '#/components/schemas/TerminalWithWorkstations'
                      required:
                        - terminals
                      example:
                        terminals:
                          - terminalUuid: "c7a1b24b0583477292ebdbaa"
                            solutionId: "2f6a6bbe78904acef70345ca"
                            terminalId: "34523860"
                            enabled: true
                            workstations:
                              - "cassa-1-ufficio-3"
                              - "cassa-2-ufficio-3"
                          - terminalUuid: "635edc54ab35f303668bbe7e"
                            solutionId: "2f6a6bbe78904acef70345ca"
                            terminalId: "34523865"
                            enabled: true
                            workstations:
                              - "cassa-3-ufficio-3"
                              - "cassa-4-ufficio-3"
                
                    Transaction:
                      description: Transaction details
                      type: object
                      additionalProperties: false
                      properties:
                        id:
                          $ref: '#/components/schemas/TransactionId'
                        terminalUuid:
                          $ref: '#/components/schemas/TerminalUuid'
                        noticeNumber:
                          $ref: '#/components/schemas/NoticeNumber'
                        payeeCode:
                          $ref: '#/components/schemas/PayeeCode'
                        creationTimestamp:
                          #description: Moment of creation of the transaction (ex. 2024-03-06T13:15:54Z, 2024-03-06T14:15:54+01:00)
                          $ref: '#/components/schemas/Timestamp'
                        lastUpdateTimestamp:
                          #description: Moment of last update of the transaction (ex. 2024-03-06T13:15:54Z, 2024-03-06T14:15:54+01:00)
                          $ref: '#/components/schemas/Timestamp'
                        status:
                          $ref: '#/components/schemas/Status'
                        amount:
                          #description: Payed amount
                          $ref: '#/components/schemas/EuroCents'
                      required:
                        - id
                        - terminalUuid
                        - noticeNumber
                        - payeeCode
                        - creationTimestamp
                        - lastUpdateTimestamp
                        - status
                      example:
                        id: "4658fcb36e520a65b1be79d0"
                        terminalUuid: "c7a1b24b0583477292ebdbaa"
                        noticeNumber: "485564829563528563"
                        payeeCode: "06534340721"
                        creationTimestamp: "2024-03-06T13:15:54Z"
                        lastUpdateTimestamp: "2024-03-06T13:16:33Z"
                        status: "CLOSED_OK"
                        amount: 12345
                
                    Transactions:
                      description: List of transactions
                      type: array
                      minItems: 0
                      maxItems: 128
                      items:
                        $ref: '#/components/schemas/Transaction'
                      example:
                        - id: "4658fcb36e520a65b1be79d0"
                          terminalUuid: "c7a1b24b0583477292ebdbaa"
                          noticeNumber: "485564829563528563"
                          payeeCode: "06534340721"
                          creationTimestamp: "2024-03-06T13:15:54Z"
                          lastUpdateTimestamp: "2024-03-06T13:16:33Z"
                          status: "CLOSED_OK"
                          amount: 12345
                
                    UpdateTransaction:
                      description: Request to update amount and status of a transaction
                      type: object
                      additionalProperties: false
                      properties:
                        status:
                          $ref: '#/components/schemas/Status'
                        amount:
                          #description: Payed amount
                          $ref: '#/components/schemas/EuroCents'
                      required:
                        - status
                        - amount
                      example:
                        status: "CLOSED_OK"
                        amount: 12345
                
                    Workstations:
                      description: List of cash desk labels
                      type: object
                      additionalProperties: false
                      properties:
                        workstations:
                          $ref: '#/components/schemas/WorkstationsArray'
                      required:
                        - workstations
                      example:
                        workstations:
                          - "cassa-1-ufficio-3"
                          - "cassa-2-ufficio-3"
                
                    WorkstationsArray:
                      description: List of cash desk labels
                      type: array
                      minItems: 0
                      maxItems: 32
                      items:
                        $ref: '#/components/schemas/Workstation'
                      example:
                        - "cassa-1-ufficio-3"
                        - "cassa-2-ufficio-3"
                
                  # ========================================================
                  # Request bodies
                  # ========================================================
                  requestBodies:
                    BulkLoadTerminals:
                      description: Request to bulk load a set of terminals.
                      content:
                        multipart/form-data:
                          schema:
                            type: object
                            properties:
                              file:
                                type: string
                                format: binary
                                maxLength: 134217728 # 256MB
                
                    CreateOrUpdateSolution:
                      description: Request to create a new solution or update an existing one
                      content:
                        application/json:
                          schema:
                            $ref: '#/components/schemas/CreateOrUpdateSolution'
                    
                    CreateOrUpdateTerminal:
                      description: Request to create a new terminal or update an existing one
                      content:
                        application/json:
                          schema:
                            $ref: '#/components/schemas/CreateOrUpdateTerminal'
                    
                    CreateTransaction:
                      description: Request to create a transaction from Public Administration (payee) portal
                      content:
                        application/json:
                          schema:
                            $ref: '#/components/schemas/CreateTransaction'
                
                    UpdateTransaction:
                      description: Request to update status and amount of a transaction
                      content:
                        application/json:
                          schema:
                            $ref: '#/components/schemas/UpdateTransaction'
                
                    UpdateWorkstations:
                      description: Request to update cash desks linked to a terminal
                      content:
                        application/json:
                          schema:
                            $ref: '#/components/schemas/Workstations'
                
                  # ========================================================
                  # Parameters
                  # ========================================================
                  parameters:
                    BulkLoadingId:
                      name: bulkLoadingId
                      in: path
                      description: ID of a bulk loading operation
                      required: true
                      schema:
                        $ref: '#/components/schemas/BulkLoadingId'
                    
                    EndDate:
                      name: endDate
                      in: query
                      description: End date of the time range in which to search for transactions
                      required: true
                      schema:
                        type: string
                        format: date
                        maxLength: 10
                        example: "2022-11-30"
                
                    PageNumber:
                      name: page
                      in: query
                      description: Number of the requested page of data
                      required: true
                      schema:
                        $ref: '#/components/schemas/PageNumber'
                
                    PageSize:
                      name: size
                      in: query
                      description: Size of the requested page of data
                      required: true
                      schema:
                        $ref: '#/components/schemas/PageSize'
                
                    PayeeCode:
                      name: payeeCode
                      in: query
                      description: Fiscal code of the subject that receives the payment
                      required: true
                      schema:
                        $ref: '#/components/schemas/PayeeCode'
                
                
                    LocationCode:
                      name: locationCode
                      in: query
                      description: Fiscal code of the subject that held the terminal
                      required: true
                      schema:
                        $ref: '#/components/schemas/LocationCode'
                      
                    PspId:
                      name: pspId
                      in: query
                      description: ID of the POS PSP
                      required: true
                      schema:
                        $ref: '#/components/schemas/PspId'
                
                    RequestId:
                      name: RequestId
                      in: header
                      description: Request Id that will be logged for troubleshooting purpose
                      required: true
                      schema:
                        $ref: '#/components/schemas/UUID'
                
                    SolutionId:
                      name: solutionId
                      in: path
                      description: Solution ID
                      required: true
                      schema:
                        $ref: '#/components/schemas/SolutionId'
                    
                    SortStrategy:
                      name: sortStrategy
                      in: query
                      required: true
                      description: Strategy used to sort returned transactions by creation timestamp
                      schema:
                        type: string
                        enum:
                          - asc
                          - desc
                        example: "desc"
                
                    StartDate:
                      name: startDate
                      in: query
                      description: Start date of the time range in which to search for transactions
                      required: true
                      schema:
                        type: string
                        format: date
                        maxLength: 10
                        example: "2022-11-30"
                
                    Status:
                      name: status
                      in: query
                      description: Status of the transactions to search for
                      required: true
                      schema:
                        $ref: '#/components/schemas/Status'
                    
                    TerminalId:
                      name: terminalId
                      in: query
                      description: ID of the terminal for the PSP
                      required: true
                      schema:
                        $ref: '#/components/schemas/TerminalId'
                    
                    TerminalUuid:
                      name: terminalUuid
                      in: path
                      description: UUID of the terminal which is the target of the operation
                      required: true
                      schema:
                        $ref: '#/components/schemas/TerminalUuid'
                
                    TransactionId:
                      name: transactionId
                      in: path
                      description: ID of the transaction target of the invoked operation
                      required: true
                      schema:
                        $ref: '#/components/schemas/TransactionId'
                
                    Workstation:
                      name: workstation
                      in: query
                      description: Cash desk label
                      required: true
                      schema:
                        $ref: '#/components/schemas/Workstation'
                
                  # ========================================================
                  # Responses
                  # ========================================================
                  responses:
                    BulkLoadingReport:
                      description: Report of a bulk loading operation
                      headers:
                        Access-Control-Allow-Origin:
                          description: Indicates whether the response can be shared with requesting code from the given origin
                          required: false
                          schema:
                            $ref: '#/components/schemas/AccessControlAllowOrigin'
                        RateLimit-Limit:
                          description: The number of allowed requests in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitLimit'
                        RateLimit-Reset:
                          description: The number of seconds left in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitReset'
                      content:
                        application/json:
                          schema:
                            type: string
                            format: binary
                            maxLength: 134217728 # 256MB
                
                    BulkLoadTerminals:
                      description: Response for bulk loading of terminals
                      headers:
                        Access-Control-Allow-Origin:
                          description: Indicates whether the response can be shared with requesting code from the given origin
                          required: false
                          schema:
                            $ref: '#/components/schemas/AccessControlAllowOrigin'
                        RateLimit-Limit:
                          description: The number of allowed requests in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitLimit'
                        RateLimit-Reset:
                          description: The number of seconds left in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitReset'
                        Location:
                          description: URL to get the status of bulk loading operation
                          required: true
                          schema:
                            $ref: '#/components/schemas/BulkLoadingLocation'
                
                    CreateSolution:
                      description: Response of create solution operation
                      headers:
                        Access-Control-Allow-Origin:
                          description: Indicates whether the response can be shared with requesting code from the given origin
                          required: false
                          schema:
                            $ref: '#/components/schemas/AccessControlAllowOrigin'
                        RateLimit-Limit:
                          description: The number of allowed requests in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitLimit'
                        RateLimit-Reset:
                          description: The number of seconds left in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitReset'
                        Location:
                          description: URL of the solution
                          required: true
                          schema:
                            $ref: '#/components/schemas/SolutionLocation'
                
                    CreateTerminal:
                      description: Response of create terminal operation
                      headers:
                        Access-Control-Allow-Origin:
                          description: Indicates whether the response can be shared with requesting code from the given origin
                          required: false
                          schema:
                            $ref: '#/components/schemas/AccessControlAllowOrigin'
                        RateLimit-Limit:
                          description: The number of allowed requests in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitLimit'
                        RateLimit-Reset:
                          description: The number of seconds left in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitReset'
                        Location:
                          description: URL of the terminal
                          required: true
                          schema:
                            $ref: '#/components/schemas/TerminalLocation'
                
                    CreateTransaction:
                      description: Response to request to create a transaction from Public Administration (payee) portal
                      headers:
                        Access-Control-Allow-Origin:
                          description: Indicates whether the response can be shared with requesting code from the given origin
                          required: false
                          schema:
                            $ref: '#/components/schemas/AccessControlAllowOrigin'
                        RateLimit-Limit:
                          description: The number of allowed requests in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitLimit'
                        RateLimit-Reset:
                          description: The number of seconds left in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitReset'
                        Location:
                          description: URL of the transaction
                          required: true
                          schema:
                            $ref: '#/components/schemas/TransactionLocation'
                
                    Error:
                      description: Error response
                      headers:
                        Access-Control-Allow-Origin:
                          description: Indicates whether the response can be shared with requesting code from the given origin
                          required: false
                          schema:
                            $ref: '#/components/schemas/AccessControlAllowOrigin'
                        RateLimit-Limit:
                          description: The number of allowed requests in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitLimit'
                        RateLimit-Reset:
                          description: The number of seconds left in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitReset'
                        Retry-After:
                          description: The number of seconds to wait before allowing a follow-up request
                          required: false
                          schema:
                            $ref: '#/components/schemas/RetryAfter'
                      content:
                        application/json:
                          schema:
                            $ref: '#/components/schemas/Errors'
                
                    NoContent:
                      description: No content response
                      headers:
                        Access-Control-Allow-Origin:
                          description: Indicates whether the response can be shared with requesting code from the given origin
                          required: false
                          schema:
                            $ref: '#/components/schemas/AccessControlAllowOrigin'
                        RateLimit-Limit:
                          description: The number of allowed requests in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitLimit'
                        RateLimit-Reset:
                          description: The number of seconds left in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitReset'
                    
                    PageOfSolutions:
                      description: Page of solutions data
                      headers:
                        Access-Control-Allow-Origin:
                          description: Indicates whether the response can be shared with requesting code from the given origin
                          required: false
                          schema:
                            $ref: '#/components/schemas/AccessControlAllowOrigin'
                        RateLimit-Limit:
                          description: The number of allowed requests in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitLimit'
                        RateLimit-Reset:
                          description: The number of seconds left in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitReset'
                      content:
                        application/json:
                          schema:
                            $ref: '#/components/schemas/PageOfSolutions'
                    
                    PageOfTerminals:
                      description: Page of terminals data
                      headers:
                        Access-Control-Allow-Origin:
                          description: Indicates whether the response can be shared with requesting code from the given origin
                          required: false
                          schema:
                            $ref: '#/components/schemas/AccessControlAllowOrigin'
                        RateLimit-Limit:
                          description: The number of allowed requests in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitLimit'
                        RateLimit-Reset:
                          description: The number of seconds left in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitReset'
                      content:
                        application/json:
                          schema:
                            $ref: '#/components/schemas/PageOfTerminals'
                
                    PageOfTerminalsWithWorkstations:
                      description: Page of terminals data
                      headers:
                        Access-Control-Allow-Origin:
                          description: Indicates whether the response can be shared with requesting code from the given origin
                          required: false
                          schema:
                            $ref: '#/components/schemas/AccessControlAllowOrigin'
                        RateLimit-Limit:
                          description: The number of allowed requests in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitLimit'
                        RateLimit-Reset:
                          description: The number of seconds left in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitReset'
                      content:
                        application/json:
                          schema:
                            $ref: '#/components/schemas/PageOfTerminalsWithWorkstations'
                
                    PageOfTransactions:
                      description: Page of retrieved transactions
                      headers:
                        Access-Control-Allow-Origin:
                          description: Indicates whether the response can be shared with requesting code from the given origin
                          required: false
                          schema:
                            $ref: '#/components/schemas/AccessControlAllowOrigin'
                        RateLimit-Limit:
                          description: The number of allowed requests in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitLimit'
                        RateLimit-Reset:
                          description: The number of seconds left in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitReset'
                      content:
                        application/json:
                          schema:
                            $ref: '#/components/schemas/PageOfTransactions'
                
                    Solution:
                      description: Retrieved solution
                      headers:
                        Access-Control-Allow-Origin:
                          description: Indicates whether the response can be shared with requesting code from the given origin
                          required: false
                          schema:
                            $ref: '#/components/schemas/AccessControlAllowOrigin'
                        RateLimit-Limit:
                          description: The number of allowed requests in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitLimit'
                        RateLimit-Reset:
                          description: The number of seconds left in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitReset'
                      content:
                        application/json:
                          schema:
                            $ref: '#/components/schemas/Solution'
                    
                    TerminalsWithWorkstations:
                      description: Terminals list
                      headers:
                        Access-Control-Allow-Origin:
                          description: Indicates whether the response can be shared with requesting code from the given origin
                          required: false
                          schema:
                            $ref: '#/components/schemas/AccessControlAllowOrigin'
                        RateLimit-Limit:
                          description: The number of allowed requests in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitLimit'
                        RateLimit-Reset:
                          description: The number of seconds left in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitReset'
                      content:
                        application/json:
                          schema:
                            $ref: '#/components/schemas/TerminalsWithWorkstations'
                
                    Transaction:
                      description: Retrieved transaction
                      headers:
                        Access-Control-Allow-Origin:
                          description: Indicates whether the response can be shared with requesting code from the given origin
                          required: false
                          schema:
                            $ref: '#/components/schemas/AccessControlAllowOrigin'
                        RateLimit-Limit:
                          description: The number of allowed requests in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitLimit'
                        RateLimit-Reset:
                          description: The number of seconds left in the current period
                          required: false
                          schema:
                            $ref: '#/components/schemas/RateLimitReset'
                      content:
                        application/json:
                          schema:
                            $ref: '#/components/schemas/Transaction'
                
                  securitySchemes:
                    oAuth2:
                      description: A bearer token in the format of a JWS and conforms to the specifications included in RFC8725
                      type: oauth2
                      flows:
                        clientCredentials:
                          tokenUrl: https://mil-d-apim.azure-api.net/mil-auth/token
                          refreshUrl: https://mil-d-apim.azure-api.net/mil-auth/token
                          scopes:
                            pos_service_provider: Represents POS Service Provider role
                            public_administration: Represents Public Administration role
                            mil_papos_admin: Represents system administrator role
            EOT -> null
        }

      - subscription_key_parameter_names {
          - header = "Ocp-Apim-Subscription-Key" -> null
          - query  = "subscription-key" -> null
        }
    }

  # azurerm_api_management_api_diagnostic.auth will be destroyed
  # (because azurerm_api_management_api_diagnostic.auth is not in configuration)
  - resource "azurerm_api_management_api_diagnostic" "auth" {
      - always_log_errors         = true -> null
      - api_management_logger_id  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/loggers/cstar-d-apim-logger" -> null
      - api_management_name       = "cstar-d-apim" -> null
      - api_name                  = "cstar-d-weu-mil-auth" -> null
      - http_correlation_protocol = "W3C" -> null
      - id                        = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/cstar-d-weu-mil-auth/diagnostics/applicationinsights" -> null
      - identifier                = "applicationinsights" -> null
      - log_client_ip             = true -> null
      - operation_name_format     = "Name" -> null
      - resource_group_name       = "cstar-d-api-rg" -> null
      - sampling_percentage       = 100 -> null
      - verbosity                 = "verbose" -> null

      - backend_request {
          - body_bytes     = 8192 -> null
          - headers_to_log = [
              - "AcquirerId",
              - "Channel",
              - "MerchantId",
              - "RequestId",
              - "TerminalId",
              - "Version",
            ] -> null
        }

      - backend_response {
          - body_bytes     = 8192 -> null
          - headers_to_log = [
              - "Cache-Control",
              - "CorrelationId",
            ] -> null
        }

      - frontend_request {
          - body_bytes     = 8192 -> null
          - headers_to_log = [
              - "AcquirerId",
              - "Channel",
              - "MerchantId",
              - "RequestId",
              - "TerminalId",
              - "Version",
            ] -> null
        }

      - frontend_response {
          - body_bytes     = 8192 -> null
          - headers_to_log = [
              - "Cache-Control",
              - "CorrelationId",
            ] -> null
        }
    }

  # azurerm_api_management_api_diagnostic.papos will be destroyed
  # (because azurerm_api_management_api_diagnostic.papos is not in configuration)
  - resource "azurerm_api_management_api_diagnostic" "papos" {
      - always_log_errors         = true -> null
      - api_management_logger_id  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/loggers/cstar-d-apim-logger" -> null
      - api_management_name       = "cstar-d-apim" -> null
      - api_name                  = "cstar-d-weu-mil-papos" -> null
      - http_correlation_protocol = "W3C" -> null
      - id                        = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/cstar-d-weu-mil-papos/diagnostics/applicationinsights" -> null
      - identifier                = "applicationinsights" -> null
      - log_client_ip             = true -> null
      - operation_name_format     = "Name" -> null
      - resource_group_name       = "cstar-d-api-rg" -> null
      - sampling_percentage       = 100 -> null
      - verbosity                 = "verbose" -> null

      - backend_request {
          - body_bytes     = 8192 -> null
          - headers_to_log = [
              - "AcquirerId",
              - "Channel",
              - "MerchantId",
              - "RequestId",
              - "TerminalId",
              - "Version",
            ] -> null
        }

      - backend_response {
          - body_bytes     = 8192 -> null
          - headers_to_log = [
              - "Location",
            ] -> null
        }

      - frontend_request {
          - body_bytes     = 8192 -> null
          - headers_to_log = [
              - "AcquirerId",
              - "Channel",
              - "MerchantId",
              - "RequestId",
              - "TerminalId",
              - "Version",
            ] -> null
        }

      - frontend_response {
          - body_bytes     = 8192 -> null
          - headers_to_log = [
              - "Location",
            ] -> null
        }
    }

  # azurerm_api_management_product.mil will be destroyed
  # (because azurerm_api_management_product.mil is not in configuration)
  - resource "azurerm_api_management_product" "mil" {
      - api_management_name   = "cstar-d-apim" -> null
      - approval_required     = false -> null
      - description           = "MIL Multi-channel Integration Layer" -> null
      - display_name          = "MIL Multi-channel Integration Layer" -> null
      - id                    = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/mil" -> null
      - product_id            = "mil" -> null
      - published             = true -> null
      - resource_group_name   = "cstar-d-api-rg" -> null
      - subscription_required = false -> null
      - subscriptions_limit   = 0 -> null
        # (1 unchanged attribute hidden)
    }

  # azurerm_api_management_product_api.auth will be destroyed
  # (because azurerm_api_management_product_api.auth is not in configuration)
  - resource "azurerm_api_management_product_api" "auth" {
      - api_management_name = "cstar-d-apim" -> null
      - api_name            = "cstar-d-weu-mil-auth" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/mil/apis/cstar-d-weu-mil-auth" -> null
      - product_id          = "mil" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
    }

  # azurerm_api_management_product_api.papos will be destroyed
  # (because azurerm_api_management_product_api.papos is not in configuration)
  - resource "azurerm_api_management_product_api" "papos" {
      - api_management_name = "cstar-d-apim" -> null
      - api_name            = "cstar-d-weu-mil-papos" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/mil/apis/cstar-d-weu-mil-papos" -> null
      - product_id          = "mil" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
    }

  # azurerm_api_management_product_policy.mil_api_product will be destroyed
  # (because azurerm_api_management_product_policy.mil_api_product is not in configuration)
  - resource "azurerm_api_management_product_policy" "mil_api_product" {
      - api_management_name = "cstar-d-apim" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/mil" -> null
      - product_id          = "mil" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
      - xml_content         = <<-EOT
            <!--
                IMPORTANT:
                - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.
                - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.
                - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.
                - To add a policy, place the cursor at the desired insertion point and select a policy from the sidebar.
                - To remove a policy, delete the corresponding policy statement from the policy document.
                - Position the <base> element within a section element to inherit all policies from the corresponding section element in the enclosing scope.
                - Remove the <base> element to prevent inheriting policies from the corresponding section element in the enclosing scope.
                - Policies are applied in the order of their appearance, from the top down.
                - Comments within policy elements are not supported and may disappear. Place your comments between policy elements or at a higher level scope.
            -->
            <policies>
            	<inbound>
            		<base />
            	</inbound>
            	<backend>
            		<base />
            	</backend>
            	<outbound>
            		<base />
            	</outbound>
            	<on-error>
            		<base />
            	</on-error>
            </policies>
        EOT -> null
    }

  # azurerm_key_vault_access_policy.access_auth_secret_kv will be destroyed
  # (because azurerm_key_vault_access_policy.access_auth_secret_kv is not in configuration)
  - resource "azurerm_key_vault_access_policy" "access_auth_secret_kv" {
      - certificate_permissions = [] -> null
      - id                      = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-mil-sec-rg/providers/Microsoft.KeyVault/vaults/cstar-d-weu-mil-auth-kv/objectId/2abc7984-9d68-4b88-816f-b33369b9c025" -> null
      - key_permissions         = [
          - "Get",
          - "List",
          - "Create",
          - "Decrypt",
          - "Delete",
          - "Encrypt",
          - "Sign",
          - "Verify",
        ] -> null
      - key_vault_id            = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-mil-sec-rg/providers/Microsoft.KeyVault/vaults/cstar-d-weu-mil-auth-kv" -> null
      - object_id               = "2abc7984-9d68-4b88-816f-b33369b9c025" -> null
      - secret_permissions      = [] -> null
      - storage_permissions     = [] -> null
      - tenant_id               = "7788edaf-0346-4068-9d79-c868aed15b3d" -> null
        # (1 unchanged attribute hidden)
    }

  # azurerm_resource_group.storage_rg will be destroyed
  # (because azurerm_resource_group.storage_rg is not in configuration)
  - resource "azurerm_resource_group" "storage_rg" {
      - id         = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-mil-storage-rg" -> null
      - location   = "westeurope" -> null
      - name       = "cstar-d-weu-mil-storage-rg" -> null
      - tags       = {
          - "CostCenter"  = "TS310 - PAGAMENTI & SERVIZI"
          - "CreatedBy"   = "Terraform"
          - "Environment" = "Dev"
          - "Owner"       = "CSTAR"
          - "Source"      = "https://github.com/pagopa/cstar-infrastructure"
        } -> null
        # (1 unchanged attribute hidden)
    }

  # azurerm_storage_account.auth will be destroyed
  # (because azurerm_storage_account.auth is not in configuration)
  - resource "azurerm_storage_account" "auth" {
      - access_tier                       = "Hot" -> null
      - account_kind                      = "StorageV2" -> null
      - account_replication_type          = "LRS" -> null
      - account_tier                      = "Standard" -> null
      - allow_nested_items_to_be_public   = true -> null
      - cross_tenant_replication_enabled  = true -> null
      - default_to_oauth_authentication   = false -> null
      - dns_endpoint_type                 = "Standard" -> null
      - enable_https_traffic_only         = true -> null
      - id                                = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-mil-storage-rg/providers/Microsoft.Storage/storageAccounts/cstardmilauthst" -> null
      - infrastructure_encryption_enabled = false -> null
      - is_hns_enabled                    = false -> null
      - local_user_enabled                = true -> null
      - location                          = "westeurope" -> null
      - min_tls_version                   = "TLS1_2" -> null
      - name                              = "cstardmilauthst" -> null
      - nfsv3_enabled                     = false -> null
      - primary_access_key                = (sensitive value) -> null
      - primary_blob_connection_string    = (sensitive value) -> null
      - primary_blob_endpoint             = "https://cstardmilauthst.blob.core.windows.net/" -> null
      - primary_blob_host                 = "cstardmilauthst.blob.core.windows.net" -> null
      - primary_connection_string         = (sensitive value) -> null
      - primary_dfs_endpoint              = "https://cstardmilauthst.dfs.core.windows.net/" -> null
      - primary_dfs_host                  = "cstardmilauthst.dfs.core.windows.net" -> null
      - primary_file_endpoint             = "https://cstardmilauthst.file.core.windows.net/" -> null
      - primary_file_host                 = "cstardmilauthst.file.core.windows.net" -> null
      - primary_location                  = "westeurope" -> null
      - primary_queue_endpoint            = "https://cstardmilauthst.queue.core.windows.net/" -> null
      - primary_queue_host                = "cstardmilauthst.queue.core.windows.net" -> null
      - primary_table_endpoint            = "https://cstardmilauthst.table.core.windows.net/" -> null
      - primary_table_host                = "cstardmilauthst.table.core.windows.net" -> null
      - primary_web_endpoint              = "https://cstardmilauthst.z6.web.core.windows.net/" -> null
      - primary_web_host                  = "cstardmilauthst.z6.web.core.windows.net" -> null
      - public_network_access_enabled     = false -> null
      - queue_encryption_key_type         = "Service" -> null
      - resource_group_name               = "cstar-d-weu-mil-storage-rg" -> null
      - secondary_access_key              = (sensitive value) -> null
      - secondary_connection_string       = (sensitive value) -> null
      - sftp_enabled                      = false -> null
      - shared_access_key_enabled         = true -> null
      - table_encryption_key_type         = "Service" -> null
      - tags                              = {
          - "CostCenter"  = "TS310 - PAGAMENTI & SERVIZI"
          - "CreatedBy"   = "Terraform"
          - "Environment" = "Dev"
          - "Owner"       = "CSTAR"
          - "Source"      = "https://github.com/pagopa/cstar-infrastructure"
        } -> null
        # (24 unchanged attributes hidden)

      - blob_properties {
          - change_feed_enabled           = false -> null
          - change_feed_retention_in_days = 0 -> null
          - last_access_time_enabled      = false -> null
          - versioning_enabled            = false -> null
            # (1 unchanged attribute hidden)
        }

      - network_rules {
          - bypass                     = [
              - "AzureServices",
            ] -> null
          - default_action             = "Allow" -> null
          - ip_rules                   = [] -> null
          - virtual_network_subnet_ids = [] -> null
        }

      - queue_properties {
          - hour_metrics {
              - enabled               = true -> null
              - include_apis          = true -> null
              - retention_policy_days = 7 -> null
              - version               = "1.0" -> null
            }
          - logging {
              - delete                = false -> null
              - read                  = false -> null
              - retention_policy_days = 0 -> null
              - version               = "1.0" -> null
              - write                 = false -> null
            }
          - minute_metrics {
              - enabled               = false -> null
              - include_apis          = false -> null
              - retention_policy_days = 0 -> null
              - version               = "1.0" -> null
            }
        }

      - share_properties {
          - retention_policy {
              - days = 7 -> null
            }
        }
    }

  # azurerm_storage_account.conf will be destroyed
  # (because azurerm_storage_account.conf is not in configuration)
  - resource "azurerm_storage_account" "conf" {
      - access_tier                       = "Hot" -> null
      - account_kind                      = "StorageV2" -> null
      - account_replication_type          = "LRS" -> null
      - account_tier                      = "Standard" -> null
      - allow_nested_items_to_be_public   = true -> null
      - cross_tenant_replication_enabled  = true -> null
      - default_to_oauth_authentication   = false -> null
      - dns_endpoint_type                 = "Standard" -> null
      - enable_https_traffic_only         = true -> null
      - id                                = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-weu-mil-storage-rg/providers/Microsoft.Storage/storageAccounts/cstardmilconfst" -> null
      - infrastructure_encryption_enabled = false -> null
      - is_hns_enabled                    = false -> null
      - local_user_enabled                = true -> null
      - location                          = "westeurope" -> null
      - min_tls_version                   = "TLS1_2" -> null
      - name                              = "cstardmilconfst" -> null
      - nfsv3_enabled                     = false -> null
      - primary_access_key                = (sensitive value) -> null
      - primary_blob_connection_string    = (sensitive value) -> null
      - primary_blob_endpoint             = "https://cstardmilconfst.blob.core.windows.net/" -> null
      - primary_blob_host                 = "cstardmilconfst.blob.core.windows.net" -> null
      - primary_connection_string         = (sensitive value) -> null
      - primary_dfs_endpoint              = "https://cstardmilconfst.dfs.core.windows.net/" -> null
      - primary_dfs_host                  = "cstardmilconfst.dfs.core.windows.net" -> null
      - primary_file_endpoint             = "https://cstardmilconfst.file.core.windows.net/" -> null
      - primary_file_host                 = "cstardmilconfst.file.core.windows.net" -> null
      - primary_location                  = "westeurope" -> null
      - primary_queue_endpoint            = "https://cstardmilconfst.queue.core.windows.net/" -> null
      - primary_queue_host                = "cstardmilconfst.queue.core.windows.net" -> null
      - primary_table_endpoint            = "https://cstardmilconfst.table.core.windows.net/" -> null
      - primary_table_host                = "cstardmilconfst.table.core.windows.net" -> null
      - primary_web_endpoint              = "https://cstardmilconfst.z6.web.core.windows.net/" -> null
      - primary_web_host                  = "cstardmilconfst.z6.web.core.windows.net" -> null
      - public_network_access_enabled     = false -> null
      - queue_encryption_key_type         = "Service" -> null
      - resource_group_name               = "cstar-d-weu-mil-storage-rg" -> null
      - secondary_access_key              = (sensitive value) -> null
      - secondary_connection_string       = (sensitive value) -> null
      - sftp_enabled                      = false -> null
      - shared_access_key_enabled         = true -> null
      - table_encryption_key_type         = "Service" -> null
      - tags                              = {
          - "CostCenter"  = "TS310 - PAGAMENTI & SERVIZI"
          - "CreatedBy"   = "Terraform"
          - "Environment" = "Dev"
          - "Owner"       = "CSTAR"
          - "Source"      = "https://github.com/pagopa/cstar-infrastructure"
        } -> null
        # (24 unchanged attributes hidden)

      - blob_properties {
          - change_feed_enabled           = false -> null
          - change_feed_retention_in_days = 0 -> null
          - last_access_time_enabled      = false -> null
          - versioning_enabled            = false -> null
            # (1 unchanged attribute hidden)
        }

      - network_rules {
          - bypass                     = [
              - "AzureServices",
            ] -> null
          - default_action             = "Allow" -> null
          - ip_rules                   = [] -> null
          - virtual_network_subnet_ids = [] -> null
        }

      - queue_properties {
          - hour_metrics {
              - enabled               = true -> null
              - include_apis          = true -> null
              - retention_policy_days = 7 -> null
              - version               = "1.0" -> null
            }
          - logging {
              - delete                = false -> null
              - read                  = false -> null
              - retention_policy_days = 0 -> null
              - version               = "1.0" -> null
              - write                 = false -> null
            }
          - minute_metrics {
              - enabled               = false -> null
              - include_apis          = false -> null
              - retention_policy_days = 0 -> null
              - version               = "1.0" -> null
            }
        }

      - share_properties {
          - retention_policy {
              - days = 7 -> null
            }
        }
    }

  # kubernetes_config_map.emd-eventhub will be updated in-place
  ~ resource "kubernetes_config_map" "emd-eventhub" {
      ~ data        = {
          - "emd-notify-error-consumer-group"     = "emd-notify-error-consumer-group" -> null
          - "emd_notify_error_topic"              = "emd-notify-error" -> null
            # (5 unchanged elements hidden)
        }
        id          = "mil/emd-eventhub"
        # (2 unchanged attributes hidden)

        # (1 unchanged block hidden)
    }

  # kubernetes_config_map.rest-client will be destroyed
  # (because kubernetes_config_map.rest-client is not in configuration)
  - resource "kubernetes_config_map" "rest-client" {
      - data      = {
          - "emd-citizen-baseurl" = "http://emd-citizen-microservice-chart:8080"
          - "emd-tpp-baseurl"     = "http://emd-tpp-microservice-chart:8080"
          - "rest_client_schema"  = "http"
        } -> null
      - id        = "mil/rest-client" -> null
      - immutable = false -> null

      - metadata {
          - generation       = 0 -> null
          - name             = "rest-client" -> null
          - namespace        = "mil" -> null
          - resource_version = "455208478" -> null
          - uid              = "749df806-604f-442f-b665-0392b5a19dc4" -> null
            # (1 unchanged attribute hidden)
        }
    }

  # module.emd_citizen.azurerm_api_management_api.this will be destroyed
  # (because azurerm_api_management_api.this is not in configuration)
  - resource "azurerm_api_management_api" "this" {
      - api_management_name   = "cstar-d-apim" -> null
      - api_type              = "http" -> null
      - description           = "EMD CITIZEN CONSENT" -> null
      - display_name          = "EMD CITIZEN CONSENT API" -> null
      - id                    = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-citizen;rev=1" -> null
      - is_current            = true -> null
      - is_online             = false -> null
      - name                  = "d-emd-citizen" -> null
      - path                  = "emd/citizen" -> null
      - protocols             = [
          - "https",
        ] -> null
      - resource_group_name   = "cstar-d-api-rg" -> null
      - revision              = "1" -> null
      - service_url           = "https://mil.weu.internal.dev.cstar.pagopa.it/emdcitizen/emd/citizen" -> null
      - soap_pass_through     = false -> null
      - subscription_required = false -> null
        # (5 unchanged attributes hidden)

      - import {
          - content_format = "openapi" -> null
          - content_value  = <<-EOT
                openapi: 3.0.3
                info:
                  title: EMD CITIZEN CONSENT API
                  version: '1.0'
                  description: |-
                    EMD CITIZEN CONSENT
                  contact:
                    name: Stefano D'Elia
                    email: stefano11.delia@emeal.nttdata.com
                
                servers:
                  - description: Development Test
                    url: https://api-io.dev.cstar.pagopa.it/emd/citizen
                    x-internal: true
                  - description: User Acceptance Test
                    url: https://api-io.uat.cstar.pagopa.it/emd/citizen
                    x-internal: true
                
                security:
                  - bearerAuth: [ ]
                
                tags:
                  - name: Citizen consent
                    description: 'Citizen consent operation'
                paths:
                  '/':
                    post:
                      tags:
                        - Citizen consent
                      summary: >-
                        ENG: Save citizen consent information - IT: Salvataggio dei consensi del cittadino
                      operationId: saveCitizenConsent
                      description: Save citizen consents
                      parameters:
                        - name: Accept-Language
                          in: header
                          description: 'ENG: Language - IT: Lingua'
                          schema:
                            type: string
                            pattern: "^[ -~]{2,5}$"
                            minLength: 2
                            maxLength: 5
                            example: it-IT
                            default: it-IT
                          required: true
                      requestBody:
                        description: 'ENG: Citizen consent details - IT: Dettagli consensi del cittadino'
                        required: true
                        content:
                          application/json:
                            schema:
                              $ref: '#/components/schemas/CitizenConsentRequestDTO'
                      responses:
                        '200':
                          description: Ok
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentResponseDTO'
                              examples:
                                example1:
                                  $ref: '#/components/examples/example1'
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '400':
                          description: Bad request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_BAD_REQUEST
                                message: Something went wrong handling the request
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '401':
                          description: Authentication failed
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_AUTHENTICATION_FAILED
                                message: Something went wrong with authentication
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '404':
                          description: The citizen consent was not found
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_NOT_ONBOARDED
                                message: Citizen consent not inserted
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '429':
                          description: Too many Request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_TOO_MANY_REQUESTS
                                message: Too many requests
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '500':
                          description: Server ERROR
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_GENERIC_ERROR
                                message: Application error
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                  '/stateUpdate':
                    put:
                      tags:
                        - Citizen consent
                      summary: >-
                        ENG: Update citizen consent state - IT: Aggiornamento dello stato dei consensi del cittadino
                      operationId: updateState
                      description: Update citizen consents
                      parameters:
                        - name: Accept-Language
                          in: header
                          description: 'ENG: Language - IT: Lingua'
                          schema:
                            type: string
                            pattern: "^[ -~]{2,5}$"
                            minLength: 2
                            maxLength: 5
                            example: it-IT
                            default: it-IT
                          required: true
                      requestBody:
                        description:  'ENG: Citizen consent details - IT: Dettagli consensi del cittadino'
                        required: true
                        content:
                          application/json:
                            schema:
                              $ref: '#/components/schemas/CitizenConsentStateUpdateDTO'
                      responses:
                        '200':
                          description: Ok
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentResponseDTO'
                              examples:
                                example2:
                                  $ref: '#/components/examples/example2'
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                
                        '400':
                          description: Bad request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_BAD_REQUEST
                                message: Something went wrong handling the request
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '401':
                          description: Authentication failed
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_AUTHENTICATION_FAILED
                                message: Something went wrong with authentication
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '404':
                          description: The citizen consent was not found
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_NOT_ONBOARDED
                                message: Citizen consent not inserted
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '429':
                          description: Too many Request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_TOO_MANY_REQUESTS
                                message: Too many requests
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '500':
                          description: Server ERROR
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_GENERIC_ERROR
                                message: Application error
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                  '/{fiscalCode}/{tppId}':
                    get:
                      tags:
                        - Citizen consent
                      summary: >-
                        ENG: Returns the Citizen consent detalil from fiscalCode and tppId associated - IT: Ritorna il dettaglio dei consensi del cittadino tramite fiscalCode e tppId
                      operationId: getConsentStatus
                      description: Get citizen consent from fiscalCode and tppId
                      parameters:
                        - name: Accept-Language
                          in: header
                          description: 'ENG: Language - IT: Lingua'
                          schema:
                            type: string
                            pattern: "^[ -~]{2,5}$"
                            minLength: 2
                            maxLength: 5
                            example: it-IT
                            default: it-IT
                          required: true
                        - name: fiscalCode
                          in: path
                          description: 'ENG: Fiscal code of the citizen - IT: codice fiscale del cittadino'
                          required: true
                          schema:
                            type: string
                            description: "Fiscal Code or P.IVA of the citizen"
                            pattern: "^[A-Za-z0-9]{11,16}$"
                            minLength: 11
                            maxLength: 16
                            example: "RSSMRO92S18L048H"
                        - name: tppId
                          in: path
                          description: 'ENG: Unique ID that identify TPP on PagoPA systems - IT: Identificativo univoco della TPP sui sistemi PagoPA'
                          required: true
                          schema:
                            type: string
                            description: "Unique ID that identify TPP on PagoPA systems"
                            pattern: "^[ -~]{1,50}$"
                            minLength: 1
                            maxLength: 50
                            example: "0e3bee29-8753-447c-b0da-1f7965558ec2_1706867960900"
                      responses:
                        '200':
                          description: Ok
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentResponseDTO'
                              examples:
                                example3:
                                  $ref: '#/components/examples/example3'
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '400':
                          description: Bad request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_BAD_REQUEST
                                message: Something went wrong handling the request
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '401':
                          description: Authentication failed
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_AUTHENTICATION_FAILED
                                message: Something went wrong with authentication
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '404':
                          description: The citizen consent was not found
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_NOT_ONBOARDED
                                message: Citizen consent not inserted
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '429':
                          description: Too many Request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_TOO_MANY_REQUESTS
                                message: Too many requests
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '500':
                          description: Server ERROR
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_GENERIC_ERROR
                                message: Application error
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                
                  '/list/{fiscalCode}':
                    get:
                      tags:
                        - Citizen consent
                      summary: >-
                        ENG: Returns the list of tpp associated with a specific citizen - IT: Restituisce la lista dei canali associati ad un determinato cittadino
                      operationId: get
                      description: Get citizen consents list from fiscalCode
                      parameters:
                        - name: Accept-Language
                          in: header
                          description: 'ENG: Language - IT: Lingua'
                          schema:
                            type: string
                            pattern: "^[ -~]{2,5}$"
                            minLength: 2
                            maxLength: 5
                            example: it-IT
                            default: it-IT
                          required: true
                        - name: fiscalCode
                          in: path
                          description: 'ENG: Fiscal code of the citizen - IT: codice fiscale del cittadino'
                          required: true
                          schema:
                            type: string
                            description: "Fiscal Code or P.IVA of the citizen"
                            pattern: "^[A-Za-z0-9]{11,16}$"
                            minLength: 11
                            maxLength: 16
                            example: "RSSMRO92S18L048H"
                      responses:
                        '200':
                          description: "A list of citizen consents"
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentResponseDTO'
                              examples:
                                example4:
                                  $ref: '#/components/examples/example4'
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '400':
                          description: Bad request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_BAD_REQUEST
                                message: Something went wrong handling the request
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '401':
                          description: Authentication failed
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_AUTHENTICATION_FAILED
                                message: Something went wrong with authentication
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '404':
                          description: The citizen consent was not found
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_NOT_ONBOARDED
                                message: Citizen consent not inserted
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '429':
                          description: Too many Request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_TOO_MANY_REQUESTS
                                message: Too many requests
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '500':
                          description: Server ERROR
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_GENERIC_ERROR
                                message: Application error
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                
                  '/list/{fiscalCode}/enabled':
                    get:
                      tags:
                        - Citizen consent
                      summary: >-
                        ENG: Returns the list of tpp enabled associated with a specific citizen - IT: Restituisce la lista dei canali abilitati associati ad un determinato cittadino
                      operationId: getTppEnabledList
                      description: Get citizen consents tppId enabled list from fiscalCode
                      parameters:
                        - name: Accept-Language
                          in: header
                          description: 'ENG: Language - IT: Lingua'
                          schema:
                            type: string
                            pattern: "^[ -~]{2,5}$"
                            minLength: 2
                            maxLength: 5
                            example: it-IT
                            default: it-IT
                          required: true
                        - name: fiscalCode
                          in: path
                          description: 'ENG: Fiscal code of the citizen - IT: codice fiscale del cittadino'
                          required: true
                          schema:
                            type: string
                            description: "Fiscal Code or P.IVA of the citizen"
                            pattern: "^[A-Za-z0-9]{11,16}$"
                            minLength: 11
                            maxLength: 16
                            example: "RSSMRO92S18L048H"
                      responses:
                        '200':
                          description: "Lista di tppId abilitati per il codice fiscale fornito"
                          content:
                            application/json:
                              schema:
                                type: array
                                items:
                                  type: string
                                  description: "Identificativo univoco di un TPP (tppId)"
                                  pattern: "^[ -~]{1,50}$"
                                  minLength: 1
                                  maxLength: 50
                                maxItems: 100
                              example:
                                - "0e3bee29-8753-447c-b0da-1f7965558ec2_1706867960900"
                                - "bcdef234-5678-90ab-cdef-abcdef012345_1706869005678"
                                - "cafe1234-babe-5678-cafe-123456789abc_1706872007890"
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                
                        '400':
                          description: Bad request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_BAD_REQUEST
                                message: Something went wrong handling the request
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '401':
                          description: Authentication failed
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_AUTHENTICATION_FAILED
                                message: Something went wrong with authentication
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '404':
                          description: The citizen consent was not found
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_NOT_ONBOARDED
                                message: Citizen consent not inserted
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '429':
                          description: Too many Request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_TOO_MANY_REQUESTS
                                message: Too many requests
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '500':
                          description: Server ERROR
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/CitizenConsentErrorDTO'
                              example:
                                code: CITIZEN_CONSENT_GENERIC_ERROR
                                message: Application error
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                
                components:
                  schemas:
                
                    AccessControlAllowOrigin:
                      description: Indicates whether the response can be shared with requesting code from the given origin
                      type: string
                      pattern: "^[ -~]{1,2048}$"
                      minLength: 1
                      maxLength: 2048
                
                    RateLimitLimit:
                      description: The number of allowed requests in the current period
                      type: integer
                      format: int32
                      minimum: 1
                      maximum: 240
                
                    RateLimitReset:
                      description: The number of seconds left in the current period
                      type: integer
                      format: int32
                      minimum: 1
                      maximum: 60
                
                    RetryAfter:
                      description: The number of seconds to wait before allowing a follow-up request
                      type: integer
                      format: int32
                      minimum: 1
                      maximum: 240
                
                    CitizenConsentRequestDTO:
                      type: object
                      description: "Schema di richiesta per aggiornare i consensi"
                      properties:
                        fiscalCode:
                          type: string
                          example: "RSSMRO92S18L048H"
                          description: "Codice fiscale dell'utente"
                          pattern: "^[A-Za-z0-9]{11,16}$"
                          minLength: 11
                          maxLength: 16
                        consents:
                          type: object
                          description: "Oggetto contenente consensi con chiavi dinamiche basate su tppId (UUID concatenati con timestamp)"
                          additionalProperties:
                            type: object
                            properties:
                              tppState:
                                type: boolean
                                description: "Stato del consenso TPP"
                                example: true
                            required:
                              - tppState
                          example:
                            "0e3bee29-8753-447c-b0da-1f7965558ec2_1706867960900":
                              tppState: true
                            "a12cd3e4-5678-90ab-cdef-1234567890ab_1706868990123":
                              tppState: true
                
                      required:
                        - fiscalCode
                        - consents
                
                
                
                    CitizenConsentResponseDTO:
                      type: object
                      description: "Schema di risposta che contiene lo stato e la data dei consensi"
                      properties:
                        fiscalCode:
                          type: string
                          example: "RSSMRO92S18L048H"
                          description: "Codice fiscale del cittadino"
                          pattern: "^[A-Za-z0-9]{11,16}$"
                          minLength: 11
                          maxLength: 16
                        consents:
                          type: object
                          description: "Oggetto contenente consensi con chiavi dinamiche basate su tppId (UUID concatenati con timestamp)"
                          additionalProperties:
                            type: object
                            properties:
                              tppState:
                                type: boolean
                                description: "Stato del consenso TPP"
                                example: true
                              tcDate:
                                type: string
                                format: date-time
                                description: "Data e ora dell'ultimo aggiornamento del consenso"
                                example: "2024-11-01T11:25:40.695Z"
                                maxLength: 30
                                pattern: "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$"
                          example:
                            "0e3bee29-8753-447c-b0da-1f7965558ec2_1706867960900":
                              tppState: true
                              tcDate: "2024-11-01T11:25:40.695Z"
                            "a12cd3e4-5678-90ab-cdef-1234567890ab_1706868990123":
                              tppState: true
                              tcDate: "2024-11-05T11:25:40.695Z"
                      required:
                        - fiscalCode
                        - consents
                
                
                    CitizenConsentStateUpdateDTO:
                      type: object
                      description: "Schema che permette la modifica dei consensi del cittadino"
                      properties:
                        fiscalCode:
                          type: string
                          example: "RSSMRO92S18L048H"
                          description: "Codice fiscale del cittadino"
                          pattern: "^[A-Za-z0-9]{11,16}$"
                          minLength: 11
                          maxLength: 16
                        tppId:
                          type: string
                          example: "0e3bee29-8753-447c-b0da-1f7965558ec2_1706867960900"
                          description: "ENG: Unique ID that identify TPP on PagoPA systems - IT: Identificativo univoco della TPP sui sistemi PagoPA"
                          pattern: "^[ -~]{1,50}$"
                          minLength: 1
                          maxLength: 50
                        tppState:
                          type: boolean
                          example: false
                          description: "Stato del consenso TPP"
                
                    CitizenConsentErrorDTO:
                      type: object
                      required:
                        - code
                        - message
                      properties:
                        code:
                          type: string
                          enum:
                            - CITIZEN_CONSENT_BAD_REQUEST
                            - CITIZEN_CONSENT_NOT_ONBOARDED
                            - CITIZEN_CONSENT_TOO_MANY_REQUESTS
                            - CITIZEN_CONSENT_GENERIC_ERROR
                            - CITIZEN_CONSENT_AUTHENTICATION_FAILED
                          description: |-
                            "ENG: Error code: CITIZEN_CONSENT_BAD_REQUEST: Something went wrong handling the request,
                             CITIZEN_CONSENT_NOT_ONBOARDED: Citizen consent not inserted,
                             CITIZEN_CONSENT_TOO_MANY_REQUESTS: Too many requests,
                             CITIZEN_CONSENT_GENERIC_ERROR: Application Error,
                             CITIZEN_CONSENT_AUTHENTICATION_FAILED: Something went wrong with authentication -
                             IT: Codice di errore:
                             CITIZEN_CONSENT_BAD_REQUEST:  Qualcosa è andato storto durante
                             l'invio della richiesta,
                             CITIZEN_CONSENT_NOT_ONBOARDED: Consensi del cittadino non inseriti,
                             CITIZEN_CONSENT_TOO_MANY_REQUESTS: Troppe richieste,
                             CITIZEN_CONSENT_GENERIC_ERROR: Errore generico,
                             CITIZEN_CONSENT_AUTHENTICATION_FAILED:  Qualcosa è andato storto con l'autenticazione"
                        message:
                          type: string
                          description: 'ENG: Error message - IT: Messaggio di errore'
                          maxLength: 250
                          pattern: "^[\\w\\s.,!?'\"-]+$"
                
                  examples:
                    example1:
                      summary: "Esempio con più consensi"
                      value:
                        fiscalCode: "RSSMRO92S18L048H"
                        consents:
                          "0e3bee29-8753-447c-b0da-1f7965558ec2_1706867960900":
                            tppState: true
                            tcDate: "2024-11-01T11:25:40.695Z"
                          "a12cd3e4-5678-90ab-cdef-1234567890ab_1706868990123":
                            tppState: true
                            tcDate: "2024-11-05T11:25:40.695Z"
                    example2:
                      summary: "Esempio con un solo consenso disattivo"
                      value:
                        fiscalCode: "RSSMRO92S18L048H"
                        consents:
                          "0e3bee29-8753-447c-b0da-1f7965558ec2_1706867960900":
                            tppState: false
                            tcDate: "2024-11-06T11:25:40.695Z"
                    example3:
                      summary: "Esempio con un solo consenso attivo"
                      value:
                        fiscalCode: "RSSMRO92S18L048H"
                        consents:
                          "0e3bee29-8753-447c-b0da-1f7965558ec2_1706867960900":
                            tppState: true
                            tcDate: "2024-11-06T11:25:40.695Z"
                    example4:
                      summary: "Esempio con un consenso attivo e uno non attivo"
                      value:
                        fiscalCode: "RSSMRO92S18L048H"
                        consents:
                          "0e3bee29-8753-447c-b0da-1f7965558ec2_1706867960900":
                            tppState: true
                            tcDate: "2024-11-01T11:25:40.695Z"
                          "a12cd3e4-5678-90ab-cdef-1234567890ab_1706868990123":
                            tppState: false
                            tcDate: "2024-11-05T11:25:40.695Z"
                  securitySchemes:
                    bearerAuth:
                      type: http
                      scheme: bearer
            EOT -> null
        }

      - subscription_key_parameter_names {
          - header = "Ocp-Apim-Subscription-Key" -> null
          - query  = "subscription-key" -> null
        }
    }

  # module.emd_citizen.azurerm_api_management_api_operation_policy.api_operation_policy["get"] will be destroyed
  # (because azurerm_api_management_api_operation_policy.api_operation_policy is not in configuration)
  - resource "azurerm_api_management_api_operation_policy" "api_operation_policy" {
      - api_management_name = "cstar-d-apim" -> null
      - api_name            = "d-emd-citizen" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-citizen/operations/get" -> null
      - operation_id        = "get" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
      - xml_content         = <<-EOT
            <!--
                IMPORTANT:
                - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.
                - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.
                - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.
                - To add a policy, place the cursor at the desired insertion point and select a policy from the sidebar.
                - To remove a policy, delete the corresponding policy statement from the policy document.
                - Position the <base> element within a section element to inherit all policies from the corresponding section element in the enclosing scope.
                - Remove the <base> element to prevent inheriting policies from the corresponding section element in the enclosing scope.
                - Policies are applied in the order of their appearance, from the top down.
                - Comments within policy elements are not supported and may disappear. Place your comments between policy elements or at a higher level scope.
            -->
            <policies>
            	<inbound>
            		<base />
            		<set-backend-service base-url="https://mil.weu.internal.dev.cstar.pagopa.it/emdcitizen" />
            		<rewrite-uri template="@("/emd/citizen/list/{fiscalCode}")" />
            	</inbound>
            	<backend>
            		<base />
            	</backend>
            	<outbound>
            		<base />
            	</outbound>
            	<on-error>
            		<base />
            	</on-error>
            </policies>
        EOT -> null
    }

  # module.emd_citizen.azurerm_api_management_api_operation_policy.api_operation_policy["getConsentStatus"] will be destroyed
  # (because azurerm_api_management_api_operation_policy.api_operation_policy is not in configuration)
  - resource "azurerm_api_management_api_operation_policy" "api_operation_policy" {
      - api_management_name = "cstar-d-apim" -> null
      - api_name            = "d-emd-citizen" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-citizen/operations/getConsentStatus" -> null
      - operation_id        = "getConsentStatus" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
      - xml_content         = <<-EOT
            <!--
                IMPORTANT:
                - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.
                - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.
                - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.
                - To add a policy, place the cursor at the desired insertion point and select a policy from the sidebar.
                - To remove a policy, delete the corresponding policy statement from the policy document.
                - Position the <base> element within a section element to inherit all policies from the corresponding section element in the enclosing scope.
                - Remove the <base> element to prevent inheriting policies from the corresponding section element in the enclosing scope.
                - Policies are applied in the order of their appearance, from the top down.
                - Comments within policy elements are not supported and may disappear. Place your comments between policy elements or at a higher level scope.
            -->
            <policies>
            	<inbound>
            		<base />
            		<set-backend-service base-url="https://mil.weu.internal.dev.cstar.pagopa.it/emdcitizen" />
            		<rewrite-uri template="@("/emd/citizen/{fiscalCode}/{tppId}")" />
            	</inbound>
            	<backend>
            		<base />
            	</backend>
            	<outbound>
            		<base />
            	</outbound>
            	<on-error>
            		<base />
            	</on-error>
            </policies>
        EOT -> null
    }

  # module.emd_citizen.azurerm_api_management_api_operation_policy.api_operation_policy["getTppEnabledList"] will be destroyed
  # (because azurerm_api_management_api_operation_policy.api_operation_policy is not in configuration)
  - resource "azurerm_api_management_api_operation_policy" "api_operation_policy" {
      - api_management_name = "cstar-d-apim" -> null
      - api_name            = "d-emd-citizen" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-citizen/operations/getTppEnabledList" -> null
      - operation_id        = "getTppEnabledList" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
      - xml_content         = <<-EOT
            <!--
                IMPORTANT:
                - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.
                - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.
                - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.
                - To add a policy, place the cursor at the desired insertion point and select a policy from the sidebar.
                - To remove a policy, delete the corresponding policy statement from the policy document.
                - Position the <base> element within a section element to inherit all policies from the corresponding section element in the enclosing scope.
                - Remove the <base> element to prevent inheriting policies from the corresponding section element in the enclosing scope.
                - Policies are applied in the order of their appearance, from the top down.
                - Comments within policy elements are not supported and may disappear. Place your comments between policy elements or at a higher level scope.
            -->
            <policies>
            	<inbound>
            		<base />
            		<set-backend-service base-url="https://mil.weu.internal.dev.cstar.pagopa.it/emdcitizen" />
            		<rewrite-uri template="@("/emd/citizen/list/{fiscalCode}/enabled")" />
            	</inbound>
            	<backend>
            		<base />
            	</backend>
            	<outbound>
            		<base />
            	</outbound>
            	<on-error>
            		<base />
            	</on-error>
            </policies>
        EOT -> null
    }

  # module.emd_citizen.azurerm_api_management_api_operation_policy.api_operation_policy["saveCitizenConsent"] will be destroyed
  # (because azurerm_api_management_api_operation_policy.api_operation_policy is not in configuration)
  - resource "azurerm_api_management_api_operation_policy" "api_operation_policy" {
      - api_management_name = "cstar-d-apim" -> null
      - api_name            = "d-emd-citizen" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-citizen/operations/saveCitizenConsent" -> null
      - operation_id        = "saveCitizenConsent" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
      - xml_content         = <<-EOT
            <!--
                IMPORTANT:
                - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.
                - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.
                - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.
                - To add a policy, place the cursor at the desired insertion point and select a policy from the sidebar.
                - To remove a policy, delete the corresponding policy statement from the policy document.
                - Position the <base> element within a section element to inherit all policies from the corresponding section element in the enclosing scope.
                - Remove the <base> element to prevent inheriting policies from the corresponding section element in the enclosing scope.
                - Policies are applied in the order of their appearance, from the top down.
                - Comments within policy elements are not supported and may disappear. Place your comments between policy elements or at a higher level scope.
            -->
            <policies>
            	<inbound>
            		<base />
            		<set-backend-service base-url="https://mil.weu.internal.dev.cstar.pagopa.it/emdcitizen" />
            		<rewrite-uri template="@("/emd/citizen")" />
            	</inbound>
            	<backend>
            		<base />
            	</backend>
            	<outbound>
            		<base />
            	</outbound>
            	<on-error>
            		<base />
            	</on-error>
            </policies>
        EOT -> null
    }

  # module.emd_citizen.azurerm_api_management_api_operation_policy.api_operation_policy["updateState"] will be destroyed
  # (because azurerm_api_management_api_operation_policy.api_operation_policy is not in configuration)
  - resource "azurerm_api_management_api_operation_policy" "api_operation_policy" {
      - api_management_name = "cstar-d-apim" -> null
      - api_name            = "d-emd-citizen" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-citizen/operations/updateState" -> null
      - operation_id        = "updateState" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
      - xml_content         = <<-EOT
            <!--
                IMPORTANT:
                - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.
                - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.
                - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.
                - To add a policy, place the cursor at the desired insertion point and select a policy from the sidebar.
                - To remove a policy, delete the corresponding policy statement from the policy document.
                - Position the <base> element within a section element to inherit all policies from the corresponding section element in the enclosing scope.
                - Remove the <base> element to prevent inheriting policies from the corresponding section element in the enclosing scope.
                - Policies are applied in the order of their appearance, from the top down.
                - Comments within policy elements are not supported and may disappear. Place your comments between policy elements or at a higher level scope.
            -->
            <policies>
            	<inbound>
            		<base />
            		<set-backend-service base-url="https://mil.weu.internal.dev.cstar.pagopa.it/emdcitizen" />
            		<rewrite-uri template="@("/emd/citizen/stateUpdate")" />
            	</inbound>
            	<backend>
            		<base />
            	</backend>
            	<outbound>
            		<base />
            	</outbound>
            	<on-error>
            		<base />
            	</on-error>
            </policies>
        EOT -> null
    }

  # module.emd_citizen.azurerm_api_management_api_policy.this[0] will be destroyed
  # (because azurerm_api_management_api_policy.this is not in configuration)
  - resource "azurerm_api_management_api_policy" "this" {
      - api_management_name = "cstar-d-apim" -> null
      - api_name            = "d-emd-citizen" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-citizen" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
      - xml_content         = <<-EOT
            <!--
                IMPORTANT:
                - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.
                - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.
                - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.
                - To add a policy, place the cursor at the desired insertion point and select a policy from the sidebar.
                - To remove a policy, delete the corresponding policy statement from the policy document.
                - Position the <base> element within a section element to inherit all policies from the corresponding section element in the enclosing scope.
                - Remove the <base> element to prevent inheriting policies from the corresponding section element in the enclosing scope.
                - Policies are applied in the order of their appearance, from the top down.
                - Comments within policy elements are not supported and may disappear. Place your comments between policy elements or at a higher level scope.
            -->
            <policies>
            	<inbound>
            		<base />
            	</inbound>
            	<backend>
            		<base />
            	</backend>
            	<outbound>
            		<base />
            	</outbound>
            	<on-error>
            		<base />
            	</on-error>
            </policies>
        EOT -> null
    }

  # module.emd_citizen.azurerm_api_management_product_api.this["emd_api_product"] will be destroyed
  # (because azurerm_api_management_product_api.this is not in configuration)
  - resource "azurerm_api_management_product_api" "this" {
      - api_management_name = "cstar-d-apim" -> null
      - api_name            = "d-emd-citizen" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/emd_api_product/apis/d-emd-citizen" -> null
      - product_id          = "emd_api_product" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
    }

  # module.emd_message_core.azurerm_api_management_api.this will be updated in-place
  ~ resource "azurerm_api_management_api" "this" {
        id                    = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-message-core;rev=1"
        name                  = "d-emd-message-core"
        # (18 unchanged attributes hidden)

      ~ import {
          ~ content_value  = <<-EOT
              - openapi: 3.0.3
              - 
              - info:
              -   title: Messages dispatcher
              -   version: 1.0.0
              -   description: Service which acts as dispatcher for messages to end-users through 3rd-party application
              -   contact:
              -     name: Antonio Tarricone
              -     email: antonio.tarricone@pagopa.it
              - 
              - servers:
              -   - description: Development Test
              -     url: https://api-io.dev.cstar.pagopa.it/emd/message-core
              -     x-internal: true
              -   - description: User Acceptance Test
              -     url: https://api-io.uat.cstar.pagopa.it/emd/message-core
              -     x-internal: true
              - 
              - tags:
              -   - name: submit
              -     description: Related to 'submit' operations
              - 
              - security:
              -   - bearerAuth: [ ]
              - 
              - paths:
              -   /sendMessage:
              -     parameters:
              -       - $ref: '#/components/parameters/RequestId'
              - 
              -     post:
              -       operationId: submitMessage
              -       description: Submit a message
              -       tags: [ submit ]
              -       requestBody:
              -         $ref: '#/components/requestBodies/SendMessage'
              -       responses:
              -         "200":
              -           #description: No channels enabled
              -           $ref: '#/components/responses/SendMessageNoChannelsEnabled'
              -         "202":
              -           #description: Accepted
              -           $ref: '#/components/responses/SendMessageOk'
              -         "400":
              -           #description: Bad request
              -           $ref: '#/components/responses/Error'
              -         "401":
              -           #description: Access token is missing or invalid
              -           $ref: '#/components/responses/Error'
              -         "403":
              -           #description: Forbidden
              -           $ref: '#/components/responses/Error'
              -         "406":
              -           #description: Not acceptable. Did you require application/json?
              -           $ref: '#/components/responses/Error'
              -         "415":
              -           #description: Unsupported media type. Did you provide application/json?
              -           $ref: '#/components/responses/Error'
              -         "429":
              -           #description: Too many requests
              -           $ref: '#/components/responses/Error'
              -         "500":
              -           #description: Server error
              -           $ref: '#/components/responses/Error'
              -         default:
              -           description: Unexpected error
              - 
              - components:
              -   schemas:
              -     AccessControlAllowOrigin:
              -       description: Indicates whether the response can be shared with requesting code from the given origin
              -       type: string
              -       pattern: "^[ -~]{1,2048}$"
              -       minLength: 1
              -       maxLength: 2048
              - 
              -     Error:
              -       description: Error details
              -       type: object
              -       additionalProperties: false
              -       properties:
              -         code:
              -           $ref: '#/components/schemas/ErrorCode'
              -         description:
              -           $ref: '#/components/schemas/ErrorDescription'
              -       required:
              -         - code
              -         - description
              -       example:
              -         code: "001000001"
              -         description: "Generic error"
              - 
              -     ErrorCode:
              -       description: Error code
              -       type: string
              -       pattern: "^[A-F0-9]{9}$"
              -       minLength: 9
              -       maxLength: 9
              -       example: "001000001"
              - 
              -     ErrorDescription:
              -       description: Error description
              -       type: string
              -       pattern: "^[ -~]{1,256}$"
              -       minLength: 1
              -       maxLength: 256
              -       example: "Unexpected error from server"
              - 
              -     Errors:
              -       description: List of errors
              -       type: object
              -       additionalProperties: false
              -       properties:
              -         errors:
              -           type: array
              -           minItems: 1
              -           maxItems: 32
              -           items:
              -             $ref: '#/components/schemas/Error'
              -       required:
              -         - errors
              -       example:
              -         errors:
              -           - code: "00000000A"
              -             description: "Generic error"
              -           - code: "001000001"
              -             description: "Unexpected error from server"
              - 
              -     OutcomeOk:
              -       description: Outcome of submit operation
              -       type: string
              -       enum:
              -         - OK
              -       example: "OK"
              - 
              -     OutcomeNoChannelsEnabled:
              -       description: Outcome of submit operation
              -       type: string
              -       enum:
              -         - NO_CHANNELS_ENABLED
              -       example: "NO_CHANNELS_ENABLED"
              - 
              -     RateLimitLimit:
              -       description: The number of allowed requests in the current period
              -       type: integer
              -       format: int32
              -       minimum: 1
              -       maximum: 240
              - 
              -     RateLimitReset:
              -       description: The number of seconds left in the current period
              -       type: integer
              -       format: int32
              -       minimum: 1
              -       maximum: 60
              - 
              -     RetryAfter:
              -       description: The number of seconds to wait before allowing a follow-up request
              -       type: integer
              -       format: int32
              -       minimum: 1
              -       maximum: 240
              - 
              -     SendMessageRequest:
              -       type: object
              -       properties:
              -         messageId:
              -           description: Unique ID of the message
              -           type: string
              -           pattern: "^[ -~]{24,64}$"
              -           minLength: 24
              -           maxLength: 64
              -         recipientId:
              -           description: ID of the recipient
              -           type: string
              -           pattern: "^[ -~]{8,64}$"
              -           minLength: 8
              -           maxLength: 64
              -         triggerDateTime:
              -           description: When (date and time) the subject who originated the message requested to send it
              -           type: string
              -           format: date-time
              -           minLength: 19
              -           maxLength: 19
              -         senderDescription:
              -           description: Description of the subject who originated the message
              -           type: string
              -           pattern: "^[ -~]{1,50}$"
              -           minLength: 1
              -           maxLength: 50
              -         messageUrl:
              -           description: URL to retrieve the original message
              -           type: string
              -           format: uri
              -           pattern: "^[ -~]{1,2048}$"
              -           minLength: 1
              -           maxLength: 2048
              -         originId:
              -           description: ID of the original message
              -           type: string
              -           pattern: "^[ -~]{24,36}$"
              -           minLength: 24
              -           maxLength: 36
              -         message:
              -           description: Content of the message
              -           type: string
              -           pattern: "^[ -~]{1,140}$"
              -           minLength: 1
              -           maxLength: 140
              -       required:
              -         - messageId
              -         - recipientId
              -         - message
              -       example:
              -         messageId: "8a32fa8a-5036-4b39-8f2e-47d3a6d23f9e"
              -         recipientId: "RSSMRA85T10A562S"
              -         triggerDateTime: "2024-06-21T12:34:56"
              -         senderDescription: "Comune di Pontecagnano"
              -         messageUrl: "http://wwww.google.it"
              -         originId: "XRUZ-GZAJ-ZUEJ-202407-W-1"
              -         message: "Nuovo messaggio!"
              - 
              -     UUID:
              -       description: UUID
              -       type: string
              -       pattern: "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"
              -       minLength: 36
              -       maxLength: 36
              -       example: "d0d654e6-97da-4848-b568-99fedccb642b"
              - 
              -   requestBodies:
              -     SendMessage:
              -       description: Request to send a message
              -       content:
              -         application/json:
              -           schema:
              -             $ref: '#/components/schemas/SendMessageRequest'
              - 
              -   parameters:
              -     RequestId:
              -       name: RequestId
              -       in: header
              -       description: Request ID that will be logged by the service
              -       required: true
              -       schema:
              -         $ref: '#/components/schemas/UUID'
              - 
              -   responses:
              -     Error:
              -       description: Error response
              -       headers:
              -         Access-Control-Allow-Origin:
              -           description: Indicates whether the response can be shared with requesting code from the given origin
              -           required: false
              -           schema:
              -             $ref: '#/components/schemas/AccessControlAllowOrigin'
              -         RateLimit-Limit:
              -           description: The number of allowed requests in the current period
              -           required: false
              -           schema:
              -             $ref: '#/components/schemas/RateLimitLimit'
              -         RateLimit-Reset:
              -           description: The number of seconds left in the current period
              -           required: false
              -           schema:
              -             $ref: '#/components/schemas/RateLimitReset'
              -         Retry-After:
              -           description: The number of seconds to wait before allowing a follow-up request
              -           required: false
              -           schema:
              -             $ref: '#/components/schemas/RetryAfter'
              -       content:
              -         application/json:
              -           schema:
              -             $ref: '#/components/schemas/Errors'
              - 
              -     SendMessageOk:
              -       description: Response to send message request when it is accepted
              -       headers:
              -         Access-Control-Allow-Origin:
              -           description: Indicates whether the response can be shared with requesting code from the given origin
              -           required: false
              -           schema:
              -             $ref: '#/components/schemas/AccessControlAllowOrigin'
              -         RateLimit-Limit:
              -           description: The number of allowed requests in the current period
              -           required: false
              -           schema:
              -             $ref: '#/components/schemas/RateLimitLimit'
              -         RateLimit-Reset:
              -           description: The number of seconds left in the current period
              -           required: false
              -           schema:
              -             $ref: '#/components/schemas/RateLimitReset'
              -         Retry-After:
              -           description: The number of seconds to wait before allowing a follow-up request
              -           required: false
              -           schema:
              -             $ref: '#/components/schemas/RetryAfter'
              -       content:
              -         application/json:
              -           schema:
              -             type: object
              -             properties:
              -               outcome:
              -                 $ref: '#/components/schemas/OutcomeOk'
              - 
              -     SendMessageNoChannelsEnabled:
              -       description: Response to send message request when no channels are enabled
              -       headers:
              -         Access-Control-Allow-Origin:
              -           description: Indicates whether the response can be shared with requesting code from the given origin
              -           required: false
              -           schema:
              -             $ref: '#/components/schemas/AccessControlAllowOrigin'
              -         RateLimit-Limit:
              -           description: The number of allowed requests in the current period
              -           required: false
              -           schema:
              -             $ref: '#/components/schemas/RateLimitLimit'
              -         RateLimit-Reset:
              -           description: The number of seconds left in the current period
              -           required: false
              -           schema:
              -             $ref: '#/components/schemas/RateLimitReset'
              -         Retry-After:
              -           description: The number of seconds to wait before allowing a follow-up request
              -           required: false
              -           schema:
              -             $ref: '#/components/schemas/RetryAfter'
              -       content:
              -         application/json:
              -           schema:
              -             type: object
              -             properties:
              -               outcome:
              -                 $ref: '#/components/schemas/OutcomeNoChannelsEnabled'
              - 
              -   securitySchemes:
              -     bearerAuth:
              -       description: A bearer token in the format of a JWS and conforms to the specifications included in RFC8725
              -       type: http
              -       scheme: bearer
              + openapi: 3.0.3
              + 
              + info:
              +   title: Messages dispatcher
              +   version: 1.0.0
              +   description: Service which acts as dispatcher for messages to end-users through 3rd-party application
              +   contact:
              +     name: Antonio Tarricone
              +     email: antonio.tarricone@pagopa.it
              + 
              + servers:
              +   - description: Development Test
              +     url: https://api-io.dev.cstar.pagopa.it/emd/message-core
              +     x-internal: true
              +   - description: User Acceptance Test
              +     url: https://api-io.uat.cstar.pagopa.it/emd/message-core
              +     x-internal: true
              + 
              + tags:
              +   - name: submit
              +     description: Related to 'submit' operations
              + 
              + security:
              +   - bearerAuth: [ ]
              + 
              + paths:
              +   /sendMessage:
              +     parameters:
              +       - $ref: '#/components/parameters/RequestId'
              + 
              +     post:
              +       operationId: submitMessage
              +       description: Submit a message
              +       tags: [ submit ]
              +       requestBody:
              +         $ref: '#/components/requestBodies/SendMessage'
              +       responses:
              +         "200":
              +           #description: No channels enabled
              +           $ref: '#/components/responses/SendMessageNoChannelsEnabled'
              +         "202":
              +           #description: Accepted
              +           $ref: '#/components/responses/SendMessageOk'
              +         "400":
              +           #description: Bad request
              +           $ref: '#/components/responses/Error'
              +         "401":
              +           #description: Access token is missing or invalid
              +           $ref: '#/components/responses/Error'
              +         "403":
              +           #description: Forbidden
              +           $ref: '#/components/responses/Error'
              +         "406":
              +           #description: Not acceptable. Did you require application/json?
              +           $ref: '#/components/responses/Error'
              +         "415":
              +           #description: Unsupported media type. Did you provide application/json?
              +           $ref: '#/components/responses/Error'
              +         "429":
              +           #description: Too many requests
              +           $ref: '#/components/responses/Error'
              +         "500":
              +           #description: Server error
              +           $ref: '#/components/responses/Error'
              +         default:
              +           description: Unexpected error
              + 
              + components:
              +   schemas:
              +     AccessControlAllowOrigin:
              +       description: Indicates whether the response can be shared with requesting code from the given origin
              +       type: string
              +       pattern: "^[ -~]{1,2048}$"
              +       minLength: 1
              +       maxLength: 2048
              + 
              +     Error:
              +       description: Error details
              +       type: object
              +       additionalProperties: false
              +       properties:
              +         code:
              +           $ref: '#/components/schemas/ErrorCode'
              +         description:
              +           $ref: '#/components/schemas/ErrorDescription'
              +       required:
              +         - code
              +         - description
              +       example:
              +         code: "001000001"
              +         description: "Generic error"
              + 
              +     ErrorCode:
              +       description: Error code
              +       type: string
              +       pattern: "^[A-F0-9]{9}$"
              +       minLength: 9
              +       maxLength: 9
              +       example: "001000001"
              + 
              +     ErrorDescription:
              +       description: Error description
              +       type: string
              +       pattern: "^[ -~]{1,256}$"
              +       minLength: 1
              +       maxLength: 256
              +       example: "Unexpected error from server"
              + 
              +     Errors:
              +       description: List of errors
              +       type: object
              +       additionalProperties: false
              +       properties:
              +         errors:
              +           type: array
              +           minItems: 1
              +           maxItems: 32
              +           items:
              +             $ref: '#/components/schemas/Error'
              +       required:
              +         - errors
              +       example:
              +         errors:
              +           - code: "00000000A"
              +             description: "Generic error"
              +           - code: "001000001"
              +             description: "Unexpected error from server"
              + 
              +     OutcomeOk:
              +       description: Outcome of submit operation
              +       type: string
              +       enum:
              +         - OK
              +       example: "OK"
              + 
              +     OutcomeNoChannelsEnabled:
              +       description: Outcome of submit operation
              +       type: string
              +       enum:
              +         - NO_CHANNELS_ENABLED
              +       example: "NO_CHANNELS_ENABLED"
              + 
              +     RateLimitLimit:
              +       description: The number of allowed requests in the current period
              +       type: integer
              +       format: int32
              +       minimum: 1
              +       maximum: 240
              + 
              +     RateLimitReset:
              +       description: The number of seconds left in the current period
              +       type: integer
              +       format: int32
              +       minimum: 1
              +       maximum: 60
              + 
              +     RetryAfter:
              +       description: The number of seconds to wait before allowing a follow-up request
              +       type: integer
              +       format: int32
              +       minimum: 1
              +       maximum: 240
              + 
              +     SendMessageRequest:
              +       type: object
              +       properties:
              +         messageId:
              +           description: Unique ID of the message
              +           type: string
              +           pattern: "^[ -~]{24,64}$"
              +           minLength: 24
              +           maxLength: 64
              +         recipientId:
              +           description: ID of the recipient
              +           type: string
              +           pattern: "^[ -~]{8,64}$"
              +           minLength: 8
              +           maxLength: 64
              +         triggerDateTime:
              +           description: When (date and time) the subject who originated the message requested to send it
              +           type: string
              +           format: date-time
              +           minLength: 19
              +           maxLength: 19
              +         senderDescription:
              +           description: Description of the subject who originated the message
              +           type: string
              +           pattern: "^[ -~]{1,50}$"
              +           minLength: 1
              +           maxLength: 50
              +         authenticationType:
              +           description: Type of authentication
              +           type: string
              +           enum:
              +             - OAUTH2
              +         authenticationUrl:
              +           description: URL to retrieve access_token
              +           type: string
              +           format: uri
              +           pattern: "^[ -~]{1,2048}$"
              +           minLength: 1
              +           maxLength: 2048
              +         messageUrl:
              +           description: URL to retrieve the original message
              +           type: string
              +           format: uri
              +           pattern: "^[ -~]{1,2048}$"
              +           minLength: 1
              +           maxLength: 2048
              +         originId:
              +           description: ID of the original message
              +           type: string
              +           pattern: "^[ -~]{24,36}$"
              +           minLength: 24
              +           maxLength: 36
              +         message:
              +           description: Content of the message
              +           type: string
              +           pattern: "^[ -~]{1,140}$"
              +           minLength: 1
              +           maxLength: 140
              +       required:
              +         - messageId
              +         - recipientId
              +         - message
              +         - authenticationType
              +       example:
              +         messageId: "8a32fa8a-5036-4b39-8f2e-47d3a6d23f9e"
              +         recipientId: "RSSMRA85T10A562S"
              +         message: "You have a ticket!"
              +         authenticationType: "OAUTH2"
              + 
              +     UUID:
              +       description: UUID
              +       type: string
              +       pattern: "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"
              +       minLength: 36
              +       maxLength: 36
              +       example: "d0d654e6-97da-4848-b568-99fedccb642b"
              + 
              +   requestBodies:
              +     SendMessage:
              +       description: Request to send a message
              +       content:
              +         application/json:
              +           schema:
              +             $ref: '#/components/schemas/SendMessageRequest'
              + 
              +   parameters:
              +     RequestId:
              +       name: RequestId
              +       in: header
              +       description: Request ID that will be logged by the service
              +       required: true
              +       schema:
              +         $ref: '#/components/schemas/UUID'
              + 
              +   responses:
              +     Error:
              +       description: Error response
              +       headers:
              +         Access-Control-Allow-Origin:
              +           description: Indicates whether the response can be shared with requesting code from the given origin
              +           required: false
              +           schema:
              +             $ref: '#/components/schemas/AccessControlAllowOrigin'
              +         RateLimit-Limit:
              +           description: The number of allowed requests in the current period
              +           required: false
              +           schema:
              +             $ref: '#/components/schemas/RateLimitLimit'
              +         RateLimit-Reset:
              +           description: The number of seconds left in the current period
              +           required: false
              +           schema:
              +             $ref: '#/components/schemas/RateLimitReset'
              +         Retry-After:
              +           description: The number of seconds to wait before allowing a follow-up request
              +           required: false
              +           schema:
              +             $ref: '#/components/schemas/RetryAfter'
              +       content:
              +         application/json:
              +           schema:
              +             $ref: '#/components/schemas/Errors'
              + 
              +     SendMessageOk:
              +       description: Response to send message request when it is accepted
              +       headers:
              +         Access-Control-Allow-Origin:
              +           description: Indicates whether the response can be shared with requesting code from the given origin
              +           required: false
              +           schema:
              +             $ref: '#/components/schemas/AccessControlAllowOrigin'
              +         RateLimit-Limit:
              +           description: The number of allowed requests in the current period
              +           required: false
              +           schema:
              +             $ref: '#/components/schemas/RateLimitLimit'
              +         RateLimit-Reset:
              +           description: The number of seconds left in the current period
              +           required: false
              +           schema:
              +             $ref: '#/components/schemas/RateLimitReset'
              +         Retry-After:
              +           description: The number of seconds to wait before allowing a follow-up request
              +           required: false
              +           schema:
              +             $ref: '#/components/schemas/RetryAfter'
              +       content:
              +         application/json:
              +           schema:
              +             type: object
              +             properties:
              +               outcome:
              +                 $ref: '#/components/schemas/OutcomeOk'
              + 
              +     SendMessageNoChannelsEnabled:
              +       description: Response to send message request when no channels are enabled
              +       headers:
              +         Access-Control-Allow-Origin:
              +           description: Indicates whether the response can be shared with requesting code from the given origin
              +           required: false
              +           schema:
              +             $ref: '#/components/schemas/AccessControlAllowOrigin'
              +         RateLimit-Limit:
              +           description: The number of allowed requests in the current period
              +           required: false
              +           schema:
              +             $ref: '#/components/schemas/RateLimitLimit'
              +         RateLimit-Reset:
              +           description: The number of seconds left in the current period
              +           required: false
              +           schema:
              +             $ref: '#/components/schemas/RateLimitReset'
              +         Retry-After:
              +           description: The number of seconds to wait before allowing a follow-up request
              +           required: false
              +           schema:
              +             $ref: '#/components/schemas/RetryAfter'
              +       content:
              +         application/json:
              +           schema:
              +             type: object
              +             properties:
              +               outcome:
              +                 $ref: '#/components/schemas/OutcomeNoChannelsEnabled'
              + 
              +   securitySchemes:
              +     bearerAuth:
              +       description: A bearer token in the format of a JWS and conforms to the specifications included in RFC8725
              +       type: http
              +       scheme: bearer
                      bearerFormat: JWT
            EOT
            # (1 unchanged attribute hidden)
        }

        # (1 unchanged block hidden)
    }

  # module.emd_tpp.azurerm_api_management_api.this will be destroyed
  # (because azurerm_api_management_api.this is not in configuration)
  - resource "azurerm_api_management_api" "this" {
      - api_management_name   = "cstar-d-apim" -> null
      - api_type              = "http" -> null
      - description           = "EMD TPP" -> null
      - display_name          = "EMD TPP API" -> null
      - id                    = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-tpp;rev=1" -> null
      - is_current            = true -> null
      - is_online             = false -> null
      - name                  = "d-emd-tpp" -> null
      - path                  = "emd/tpp" -> null
      - protocols             = [
          - "https",
        ] -> null
      - resource_group_name   = "cstar-d-api-rg" -> null
      - revision              = "1" -> null
      - service_url           = "https://mil.weu.internal.dev.cstar.pagopa.it/emdtpp/emd/tpp" -> null
      - soap_pass_through     = false -> null
      - subscription_required = false -> null
        # (5 unchanged attributes hidden)

      - import {
          - content_format = "openapi" -> null
          - content_value  = <<-EOT
                openapi: 3.0.3
                
                info:
                  title: EMD TPP API
                  version: '1.0'
                  description: |-
                    EMD TPP
                  contact:
                    name: Stefano D'Elia
                    email: stefano11.delia@emeal.nttdata.com
                
                servers:
                  - description: Development Test
                    url: https://api-io.dev.cstar.pagopa.it/emd/tpp
                    x-internal: true
                  - description: User Acceptance Test
                    url: https://api-io.uat.cstar.pagopa.it/emd/tpp
                    x-internal: true
                
                security:
                  - bearerAuth: [ ]
                
                tags:
                  - name: TPP
                    description: 'TPP operation'
                paths:
                  '/':
                    post:
                      tags:
                        - TPP
                      summary: >-
                        ENG: Returns the TPP information - IT: Ritorna le informazioni della TPP
                      operationId: upsert
                      description: Add or update TPP information
                      parameters:
                        - name: Accept-Language
                          in: header
                          description: 'ENG: Language - IT: Lingua'
                          schema:
                            type: string
                            pattern: "^[ -~]{2,5}$"
                            minLength: 2
                            maxLength: 5
                            example: it-IT
                            default: it-IT
                          required: true
                      requestBody:
                        description: 'ENG: TPP details - IT: Dettagli della TPP'
                        required: true
                        content:
                          application/json:
                            schema:
                              $ref: '#/components/schemas/TppDTO'
                      responses:
                        '200':
                          description: Ok
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TppDTOWithDates'
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '400':
                          description: Bad request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_BAD_REQUEST
                                message: Something went wrong handling the request
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '401':
                          description: Authentication failed
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_AUTHENTICATION_FAILED
                                message: Something went wrong with authentication
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '404':
                          description: The TPP was not found
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_NOT_ONBOARDED
                                message: Tpp not onboarded
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '429':
                          description: Too many Request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_TOO_MANY_REQUESTS
                                message: Too many requests
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '500':
                          description: Server ERROR
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_GENERIC_ERROR
                                message: Application error
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                    put:
                      tags:
                        - TPP
                      summary: >-
                        ENG: Update TPP consent state - IT: Aggiornamento dello stato dei consensi della TPP
                      operationId: updateState
                      description: Update TPP state
                      parameters:
                        - name: Accept-Language
                          in: header
                          description: 'ENG: Language - IT: Lingua'
                          schema:
                            type: string
                            pattern: "^[ -~]{2,5}$"
                            minLength: 2
                            maxLength: 5
                            example: it-IT
                            default: it-IT
                          required: true
                      requestBody:
                        description: 'ENG: TPP identifier and state - IT: Identificativo univoco della TPP e stato'
                        required: true
                        content:
                          application/json:
                            schema:
                              $ref: '#/components/schemas/TppDTOUpdateState'
                            example:
                              tppId: 0e3bee29-8753-447c-b0da-1f7965558ec2_1706867960900
                              state: false
                      responses:
                        '200':
                          description: Ok
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TppDTOWithDates'
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '400':
                          description: Bad request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_BAD_REQUEST
                                message: Something went wrong handling the request
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '401':
                          description: Authentication failed
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_AUTHENTICATION_FAILED
                                message: Something went wrong with authentication
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '404':
                          description: The TPP was not found
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_NOT_ONBOARDED
                                message: Tpp not onboarded
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '429':
                          description: Too many Request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_TOO_MANY_REQUESTS
                                message: Too many requests
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '500':
                          description: Server ERROR
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_GENERIC_ERROR
                                message: Application error
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                  '/{tppId}':
                    get:
                      tags:
                        - TPP
                      summary: >-
                        ENG: Returns the TPP detalil from tppId associated - IT: Ritorna il dettaglio della TPP attraverso il tppId
                      operationId: get
                      description: Get TPP detail from tppId
                      parameters:
                        - name: Accept-Language
                          in: header
                          description: 'ENG: Language - IT: Lingua'
                          schema:
                            type: string
                            pattern: "^[ -~]{2,5}$"
                            minLength: 2
                            maxLength: 5
                            example: it-IT
                            default: it-IT
                          required: true
                        - name: tppId
                          in: path
                          description: 'ENG: Unique ID that identify TPP on PagoPA systems - IT: Identificativo univoco della TPP sui sistemi PagoPA'
                          required: true
                          schema:
                            type: string
                            pattern: "^[ -~]{1,50}$"
                            minLength: 50
                            maxLength: 50
                            example: "0e3bee29-8753-447c-b0da-1f7965558ec2_1706867960900"
                      responses:
                        '200':
                          description: Ok
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TppDTOWithDates'
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '400':
                          description: Bad request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_BAD_REQUEST
                                message: Something went wrong handling the request
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '401':
                          description: Authentication failed
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_AUTHENTICATION_FAILED
                                message: Something went wrong with authentication
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '404':
                          description: The TPP was not found
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_NOT_ONBOARDED
                                message: Tpp not onboarded
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '429':
                          description: Too many Request
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_TOO_MANY_REQUESTS
                                message: Too many requests
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                        '500':
                          description: Server ERROR
                          content:
                            application/json:
                              schema:
                                $ref: '#/components/schemas/TPPErrorDTO'
                              example:
                                code: TPP_GENERIC_ERROR
                                message: Application error
                          headers:
                            Access-Control-Allow-Origin:
                              description: Indicates whether the response can be shared with requesting code from the given origin
                              required: false
                              schema:
                                $ref: '#/components/schemas/AccessControlAllowOrigin'
                            RateLimit-Limit:
                              description: The number of allowed requests in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitLimit'
                            RateLimit-Reset:
                              description: The number of seconds left in the current period
                              required: false
                              schema:
                                $ref: '#/components/schemas/RateLimitReset'
                            Retry-After:
                              description: The number of seconds to wait before allowing a follow-up request
                              required: false
                              schema:
                                $ref: '#/components/schemas/RetryAfter'
                
                
                
                components:
                  schemas:
                
                    AccessControlAllowOrigin:
                      description: Indicates whether the response can be shared with requesting code from the given origin
                      type: string
                      pattern: "^[ -~]{1,2048}$"
                      minLength: 1
                      maxLength: 2048
                
                    RateLimitLimit:
                      description: The number of allowed requests in the current period
                      type: integer
                      format: int32
                      minimum: 1
                      maximum: 240
                
                    RateLimitReset:
                      description: The number of seconds left in the current period
                      type: integer
                      format: int32
                      minimum: 1
                      maximum: 60
                
                    RetryAfter:
                      description: The number of seconds to wait before allowing a follow-up request
                      type: integer
                      format: int32
                      minimum: 1
                      maximum: 240
                
                    TppDTOUpdateState:
                      type: object
                      required:
                        - tppId
                        - state
                      description: "TPP information(Third Party Provider)"
                      properties:
                        tppId:
                          type: string
                          description: "Unique ID that identify TPP on PagoPA systems"
                          pattern: "^[ -~]{1,50}$"
                          minLength: 50
                          maxLength: 50
                          example: "0e3bee29-8753-447c-b0da-1f7965558ec2_1706867960900"
                        state:
                          type: boolean
                          description: "Status active/inactive"
                          example: true
                
                    TppDTO:
                      type: object
                      required:
                        - entityId
                        - businessName
                        - legalAddress
                        - messageUrl
                        - authenticationUrl
                        - authenticationType
                        - contact
                      description: "TPP information(Third Party Provider)"
                      properties:
                        tppId:
                          type: string
                          description: "Unique ID that identify TPP on PagoPA systems"
                          pattern: "^[ -~]{1,50}$"
                          minLength: 1
                          maxLength: 50
                          example: "0e3bee29-8753-447c-b0da-1f7965558ec2_1706867960900"
                        entityId:
                          type: string
                          description: "Fiscal Code or P.IVA of the TPP"
                          pattern: "^[A-Za-z0-9]{11,16}$"
                          minLength: 11
                          maxLength: 16
                          example: "86363574890"
                        idPsp:
                          type: string
                          description: "Id of Payment Service Provider"
                          pattern: "^[A-Za-z0-9 ]+$"
                          minLength: 1
                          maxLength: 50
                          example: "MasterCard 123"
                        businessName:
                          type: string
                          description: "Company Name"
                          pattern: "^[ -~]{1,70}$"
                          minLength: 1
                          maxLength: 70
                          example: "MyBusiness Ltd"
                        legalAddress:
                          type: string
                          description: "Company Legal Address"
                          pattern: "^[ -~]{1,70}$"
                          minLength: 1
                          maxLength: 70
                          example: "Via Washington, 13"
                        messageUrl:
                          type: string
                          description: "URL to notify PUSH message"
                          format: uri
                          pattern: "^[ -~]{1,2048}$"
                          minLength: 1
                          maxLength: 2048
                          example: "https://api.tpp.com/message"
                        authenticationUrl:
                          type: string
                          description: "url for authentication"
                          format: uri
                          pattern: "^[ -~]{1,2048}$"
                          minLength: 1
                          maxLength: 2048
                          example: "https://api.tpp.com/auth"
                        authenticationType:
                          type: string
                          description: "authentication type"
                          enum:
                            - OAUTH2
                          example: "OAUTH2"
                        contact:
                          $ref: '#/components/schemas/Contact'
                        state:
                          type: boolean
                          description: "Status active/inactive"
                          example: true
                
                    Contact:
                      type: object
                      required:
                        - name
                        - number
                        - email
                      description: "Contact information about TPP"
                      properties:
                        name:
                          type: string
                          description: "Contact name"
                          example: "John Doe"
                          pattern: "^[ -~]{1,50}$"
                          minLength: 1
                          maxLength: 50
                        number:
                          type: string
                          description: "Telephone number"
                          example: "+393456780019"
                          pattern: "^(\\+\\d{1,3})?\\d{8,15}$"
                          minLength: 8
                          maxLength: 15
                        email:
                          type: string
                          description: "Contact email"
                          example: "john.doe@tpp.com"
                          format: email
                          maxLength: 100
                
                
                    TppDTOWithDates:
                      allOf:
                        - $ref: '#/components/schemas/TppDTO'
                        - type: object
                          description: "TPP information with date fields"
                          properties:
                            creationDate:
                              type: string
                              format: date-time
                              description: "The date and time when the TPP was created"
                              example: "2023-10-01T12:00:40.695Z"
                              maxLength: 30
                              pattern: "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$"
                            lastUpdateDate:
                              type: string
                              format: date-time
                              description: "The date and time when the TPP was last updated"
                              example: "2023-10-15T08:30:40.695Z"
                              maxLength: 30
                              pattern: "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$"
                
                    TPPErrorDTO:
                      type: object
                      required:
                        - code
                        - message
                      properties:
                        code:
                          type: string
                          enum:
                            - TPP_BAD_REQUEST
                            - TPP_NOT_ONBOARDED
                            - TPP_TOO_MANY_REQUESTS
                            - TPP_GENERIC_ERROR
                            - TPP_AUTHENTICATION_FAILED
                          description: |-
                            "ENG: Error code: TPP_BAD_REQUEST: Something went wrong handling the request,
                             TPP_NOT_ONBOARDED: TPP not onboarded,
                             TPP_TOO_MANY_REQUESTS: Too many requests,
                             TPP_GENERIC_ERROR: Application Error,
                             TPP_AUTHENTICATION_FAILED: Something went wrong with authentication - IT: Codice di errore:
                             TPP_BAD_REQUEST:  Qualcosa è andato storto durante l'invio della richiesta,
                             TPP_NOT_ONBOARDED: TPP non onboardata,
                             TPP_TOO_MANY_REQUESTS: Troppe richieste,
                             TPP_GENERIC_ERROR: Errore generico,
                             TPP_AUTHENTICATION_FAILED: Qualcosa è andato storto con l'autenticazione"
                        message:
                          type: string
                          description: 'ENG: Error message - IT: Messaggio di errore'
                          maxLength: 250
                          pattern: "^[\\w\\s.,!?'\"-]+$"
                
                  securitySchemes:
                    bearerAuth:
                      type: http
                      scheme: bearer
            EOT -> null
        }

      - subscription_key_parameter_names {
          - header = "Ocp-Apim-Subscription-Key" -> null
          - query  = "subscription-key" -> null
        }
    }

  # module.emd_tpp.azurerm_api_management_api_operation_policy.api_operation_policy["get"] will be destroyed
  # (because azurerm_api_management_api_operation_policy.api_operation_policy is not in configuration)
  - resource "azurerm_api_management_api_operation_policy" "api_operation_policy" {
      - api_management_name = "cstar-d-apim" -> null
      - api_name            = "d-emd-tpp" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-tpp/operations/get" -> null
      - operation_id        = "get" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
      - xml_content         = <<-EOT
            <!--
                IMPORTANT:
                - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.
                - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.
                - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.
                - To add a policy, place the cursor at the desired insertion point and select a policy from the sidebar.
                - To remove a policy, delete the corresponding policy statement from the policy document.
                - Position the <base> element within a section element to inherit all policies from the corresponding section element in the enclosing scope.
                - Remove the <base> element to prevent inheriting policies from the corresponding section element in the enclosing scope.
                - Policies are applied in the order of their appearance, from the top down.
                - Comments within policy elements are not supported and may disappear. Place your comments between policy elements or at a higher level scope.
            -->
            <policies>
            	<inbound>
            		<base />
            		<set-backend-service base-url="https://mil.weu.internal.dev.cstar.pagopa.it/emdtpp" />
            		<rewrite-uri template="@("/emd/tpp/{tppId}")" />
            	</inbound>
            	<backend>
            		<base />
            	</backend>
            	<outbound>
            		<base />
            	</outbound>
            	<on-error>
            		<base />
            	</on-error>
            </policies>
        EOT -> null
    }

  # module.emd_tpp.azurerm_api_management_api_operation_policy.api_operation_policy["updateState"] will be destroyed
  # (because azurerm_api_management_api_operation_policy.api_operation_policy is not in configuration)
  - resource "azurerm_api_management_api_operation_policy" "api_operation_policy" {
      - api_management_name = "cstar-d-apim" -> null
      - api_name            = "d-emd-tpp" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-tpp/operations/updateState" -> null
      - operation_id        = "updateState" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
      - xml_content         = <<-EOT
            <!--
                IMPORTANT:
                - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.
                - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.
                - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.
                - To add a policy, place the cursor at the desired insertion point and select a policy from the sidebar.
                - To remove a policy, delete the corresponding policy statement from the policy document.
                - Position the <base> element within a section element to inherit all policies from the corresponding section element in the enclosing scope.
                - Remove the <base> element to prevent inheriting policies from the corresponding section element in the enclosing scope.
                - Policies are applied in the order of their appearance, from the top down.
                - Comments within policy elements are not supported and may disappear. Place your comments between policy elements or at a higher level scope.
            -->
            <policies>
            	<inbound>
            		<base />
            		<set-backend-service base-url="https://mil.weu.internal.dev.cstar.pagopa.it/emdtpp" />
            		<rewrite-uri template="@("/emd/tpp")" />
            	</inbound>
            	<backend>
            		<base />
            	</backend>
            	<outbound>
            		<base />
            	</outbound>
            	<on-error>
            		<base />
            	</on-error>
            </policies>
        EOT -> null
    }

  # module.emd_tpp.azurerm_api_management_api_operation_policy.api_operation_policy["upsert"] will be destroyed
  # (because azurerm_api_management_api_operation_policy.api_operation_policy is not in configuration)
  - resource "azurerm_api_management_api_operation_policy" "api_operation_policy" {
      - api_management_name = "cstar-d-apim" -> null
      - api_name            = "d-emd-tpp" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-tpp/operations/upsert" -> null
      - operation_id        = "upsert" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
      - xml_content         = <<-EOT
            <!--
                IMPORTANT:
                - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.
                - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.
                - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.
                - To add a policy, place the cursor at the desired insertion point and select a policy from the sidebar.
                - To remove a policy, delete the corresponding policy statement from the policy document.
                - Position the <base> element within a section element to inherit all policies from the corresponding section element in the enclosing scope.
                - Remove the <base> element to prevent inheriting policies from the corresponding section element in the enclosing scope.
                - Policies are applied in the order of their appearance, from the top down.
                - Comments within policy elements are not supported and may disappear. Place your comments between policy elements or at a higher level scope.
            -->
            <policies>
            	<inbound>
            		<base />
            		<set-backend-service base-url="https://mil.weu.internal.dev.cstar.pagopa.it/emdtpp" />
            		<rewrite-uri template="@("/emd/tpp")" />
            	</inbound>
            	<backend>
            		<base />
            	</backend>
            	<outbound>
            		<base />
            	</outbound>
            	<on-error>
            		<base />
            	</on-error>
            </policies>
        EOT -> null
    }

  # module.emd_tpp.azurerm_api_management_api_policy.this[0] will be destroyed
  # (because azurerm_api_management_api_policy.this is not in configuration)
  - resource "azurerm_api_management_api_policy" "this" {
      - api_management_name = "cstar-d-apim" -> null
      - api_name            = "d-emd-tpp" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/apis/d-emd-tpp" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
      - xml_content         = <<-EOT
            <!--
                IMPORTANT:
                - Policy elements can appear only within the <inbound>, <outbound>, <backend> section elements.
                - To apply a policy to the incoming request (before it is forwarded to the backend service), place a corresponding policy element within the <inbound> section element.
                - To apply a policy to the outgoing response (before it is sent back to the caller), place a corresponding policy element within the <outbound> section element.
                - To add a policy, place the cursor at the desired insertion point and select a policy from the sidebar.
                - To remove a policy, delete the corresponding policy statement from the policy document.
                - Position the <base> element within a section element to inherit all policies from the corresponding section element in the enclosing scope.
                - Remove the <base> element to prevent inheriting policies from the corresponding section element in the enclosing scope.
                - Policies are applied in the order of their appearance, from the top down.
                - Comments within policy elements are not supported and may disappear. Place your comments between policy elements or at a higher level scope.
            -->
            <policies>
            	<inbound>
            		<base />
            	</inbound>
            	<backend>
            		<base />
            	</backend>
            	<outbound>
            		<base />
            	</outbound>
            	<on-error>
            		<base />
            	</on-error>
            </policies>
        EOT -> null
    }

  # module.emd_tpp.azurerm_api_management_product_api.this["emd_api_product"] will be destroyed
  # (because azurerm_api_management_product_api.this is not in configuration)
  - resource "azurerm_api_management_product_api" "this" {
      - api_management_name = "cstar-d-apim" -> null
      - api_name            = "d-emd-tpp" -> null
      - id                  = "/subscriptions/4d177dd6-5c7d-40ab-8019-0c1be380a25d/resourceGroups/cstar-d-api-rg/providers/Microsoft.ApiManagement/service/cstar-d-apim/products/emd_api_product/apis/d-emd-tpp" -> null
      - product_id          = "emd_api_product" -> null
      - resource_group_name = "cstar-d-api-rg" -> null
    }

Plan: 0 to add, 2 to change, 27 to destroy.

─────────────────────────────────────────────────────────────────────────────

Note: You didn't use the -out option to save this plan, so Terraform can't
guarantee to take exactly these actions if you run "terraform apply" now.
